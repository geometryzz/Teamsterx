rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // ============================
    // AVATARS
    // Matches files like: avatars/USER_ID.png
    // ============================
    match /avatars/{fileName} {
      
      // READ: Anyone logged in can see avatars
      allow read: if request.auth != null;

      // WRITE: User can only upload if filename starts with their UID
      // Example: "abc12345.png" matches user "abc12345"
      allow write: if request.auth != null
                   && fileName.matches(request.auth.uid + '(\\..+)?')
                   && request.resource.size < 2 * 1024 * 1024
                   && request.resource.contentType.matches('image/.*');

      // DELETE: User can only delete if filename starts with their UID
      allow delete: if request.auth != null
                    && fileName.matches(request.auth.uid + '(\\..+)?');
    }

    // ============================
    // TEAM FILES (Placeholder)
    // ============================
    match /teams/{teamId}/files/{allPaths=**} {
      allow read, write: if false;
    }
  }
}