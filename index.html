<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Teamsterx - Internal Collaboration Platform</title>
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-circle.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-circle.png">
    <link rel="shortcut icon" href="img/favicon-circle.png">
    <link rel="apple-touch-icon" href="img/favicon-circle.png">
    <link rel="manifest" href="manifest.json" id="manifest-link">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Teamsterx">
    <script src="version.js"></script>
    <link rel="stylesheet" href="loader.css">
    <link rel="stylesheet" href="styles.css?v=65" id="styles-link">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- DOMPurify for XSS protection in rich text content -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js" integrity="sha512-H+rglffZ6f5gF7UJgvH4Naa+fGCgjrHKMgoFOGmcPTRwR6oILo5R+gtzNrpDp7iMV3udbymBVjkeZGNz1Em4rQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- html2pdf.js for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Apply dark mode immediately to prevent flash -->
    <script>
        (function() {
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            let themePref = localStorage.getItem('themePreference');
            if (!themePref) {
                const legacy = localStorage.getItem('darkMode');
                themePref = legacy === 'true' ? 'dark' : legacy === 'false' ? 'light' : 'system';
            }
            const isDark = themePref === 'dark' || (themePref === 'system' && prefersDark);
            if (isDark) {
                document.documentElement.classList.add('dark-mode');
            }

            // Set browser chrome color based on theme
            const metaTheme = document.querySelector('meta[name="theme-color"]');
            const appleStatus = document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');
            const applyMeta = (forceDark) => {
                if (!metaTheme) return;
                const dark = typeof forceDark === 'boolean' ? forceDark : document.documentElement.classList.contains('dark-mode');
                metaTheme.setAttribute('content', dark ? '#000000' : '#ffffff');
                if (appleStatus) {
                    appleStatus.setAttribute('content', dark ? 'black' : 'default');
                }
            };

            applyMeta(isDark);
            window.__setThemeMeta = applyMeta;
        })();
        // Auto-update version on links
        const manifestLink = document.getElementById('manifest-link');
        const versionTag = window.APP_VERSION || Date.now();

        document.getElementById('styles-link').href = `styles.css?v=${versionTag}`;

        if (manifestLink) {
            manifestLink.href = `manifest.json?v=${versionTag}`;
        }
    </script>
</head>
<body>
    <!-- Apply dark mode class to body immediately -->
    <script>
        (function() {
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            let themePref = localStorage.getItem('themePreference');
            if (!themePref) {
                const legacy = localStorage.getItem('darkMode');
                themePref = legacy === 'true' ? 'dark' : legacy === 'false' ? 'light' : 'system';
            }
            const isDark = themePref === 'dark' || (themePref === 'system' && prefersDark);
            if (isDark) {
                document.body.classList.add('dark-mode');
            }
        })();
    </script>

    <!-- Teamsterx Loader Overlay -->
    <div id="teamsterxLoader" class="teamsterx-loader">
        <div class="loader-container">
            <div class="loader-bubbles">
                <div class="loader-bubble"></div>
                <div class="loader-bubble"></div>
                <div class="loader-bubble"></div>
                <div class="loader-bubble"></div>
                <div class="loader-bubble"></div>
                <div class="loader-bubble"></div>
                <div class="loader-bubble"></div>
                <div class="loader-bubble"></div>
            </div>
            <img src="img/logo-no-bg.png" alt="Teamsterx" class="loader-logo">
            <span class="loader-text">Loading</span>
        </div>
    </div>

    <!-- ============================================
         MARKETING HOMEPAGE MOUNT POINT
         Content lazy-loaded from /home/home.html
         ============================================ -->
    <div id="homeMount" style="display: none;"></div>

    <!-- ============================================
         MAIN APP CONTAINER (Protected - shown at "/app")
         ============================================ -->
    <div class="app-container" id="appContainer">
        
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="img/logo-no-bg.png" alt="Teamsterx" class="logo-img">
                    <span>Teamsterx</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <button class="nav-item active" data-section="activity">
                    <i class="fas fa-th-large"></i>
                    <span>Overview</span>
                </button>
                <button class="nav-item" data-section="team">
                    <i class="fas fa-users"></i>
                    <span>Team</span>
                </button>
                <button class="nav-item" data-section="chat">
                    <i class="fas fa-comments"></i>
                    <span>Chat</span>
                    <span class="notification-badge" id="chatNotificationBadge" style="display: none;">0</span>
                </button>
                <button class="nav-item" data-section="calendar">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Calendar</span>
                </button>
                <button class="nav-item" data-section="tasks">
                    <i class="fas fa-table-list"></i>
                    <span>Workspace</span>
                </button>
                <button class="nav-item hidden" data-section="metrics" id="metricsNavItem" style="display: none;">
                    <i class="fas fa-chart-line"></i>
                    <span>Metrics</span>
                </button>
                <button class="nav-item hidden" data-section="finances" id="financesNavItem" style="display: none;">
                    <i class="fas fa-dollar-sign"></i>
                    <span>Finances</span>
                </button>
                <button class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </button>
            </nav>
            
            <!-- Quick Add Button -->
            <div style="padding: 15px; border-bottom: 1px solid var(--border-subtle); display: none;">
                <button class="btn-add-quick btn-primary" style="width: 100%;">
                    <i class="fas fa-plus"></i> Quick
                </button>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-profile" id="userProfileCard" onclick="openSettings()" style="cursor: pointer;" title="Click to edit profile">
                    <div class="user-avatar" id="sidebarAvatar"></div>
                    <div class="user-info">
                        <div class="user-name" id="sidebarUserName">Loading...</div>
                        <div class="user-status">
                            <span class="status-indicator online"></span>
                            <span>Available</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="search-wrapper">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search messages, tasks, events..." id="globalSearchInput">
                        <button class="search-clear" id="searchClear" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="search-results" id="searchResults" style="display: none;"></div>
                </div>
                <div class="top-bar-actions">
                    <div style="position: relative;">
                        <button class="icon-btn" id="notificationsBtn">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                        </button>
                        <div class="notifications-dropdown" id="notificationsDropdown" style="display: none;">
                            <div class="notifications-header">
                                <h3>Notifications</h3>
                                <button class="mark-read-btn" id="markAllReadBtn" onclick="markAllNotificationsRead()">Mark all read</button>
                            </div>
                            <div class="notifications-list" id="notificationsList">
                                <div class="no-notifications">No new notifications</div>
                            </div>
                        </div>
                    </div>
                    <div style="position: relative;">
                        <button class="icon-btn" id="topBarSettingsBtn">
                            <i class="fas fa-cog"></i>
                        </button>
                        <div class="settings-dropdown" id="settingsDropdown" style="display: none;">
                            <div class="dropdown-item" onclick="openSettings()">
                                <i class="fas fa-user-circle"></i>
                                <span>My Account</span>
                            </div>
                            <div class="dropdown-item" onclick="signOutUser()">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Sign Out</span>
                            </div>
                        </div>
                    </div>
                    <button class="topbar-avatar" id="topBarAvatar" aria-label="Open settings"></button>
                </div>
            </header>

            <!-- Overview/Dashboard Section -->
            <section class="content-section active" id="activity-section">
                <div class="section-header">
                    <h1>Overview</h1>
                    <p class="section-subtitle">Your tasks, events, and team activity at a glance</p>
                </div>
                
                <!-- Skeleton Loading State -->
                <div class="skeleton-section" id="overview-skeleton">
                    <div class="overview-stats">
                        <div class="skeleton-stat-card">
                            <div class="skeleton skeleton-stat-icon"></div>
                            <div class="skeleton-stat-content">
                                <div class="skeleton skeleton-stat-number"></div>
                                <div class="skeleton skeleton-stat-label"></div>
                            </div>
                        </div>
                        <div class="skeleton-stat-card">
                            <div class="skeleton skeleton-stat-icon"></div>
                            <div class="skeleton-stat-content">
                                <div class="skeleton skeleton-stat-number"></div>
                                <div class="skeleton skeleton-stat-label"></div>
                            </div>
                        </div>
                        <div class="skeleton-stat-card">
                            <div class="skeleton skeleton-stat-icon"></div>
                            <div class="skeleton-stat-content">
                                <div class="skeleton skeleton-stat-number"></div>
                                <div class="skeleton skeleton-stat-label"></div>
                            </div>
                        </div>
                    </div>
                    <div class="overview-two-col" style="margin-top: 24px;">
                        <div class="skeleton-card">
                            <div class="skeleton skeleton-title"></div>
                            <div class="skeleton skeleton-text long"></div>
                            <div class="skeleton skeleton-text medium"></div>
                            <div class="skeleton skeleton-text short"></div>
                        </div>
                        <div class="skeleton-card">
                            <div class="skeleton skeleton-title"></div>
                            <div class="skeleton skeleton-text long"></div>
                            <div class="skeleton skeleton-text medium"></div>
                            <div class="skeleton skeleton-text short"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Stats Cards -->
                <div class="overview-stats real-content">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--accent);">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="myTasksCount">0</div>
                            <div class="stat-label">My Tasks</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--warning);">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="upcomingEventsCount">0</div>
                            <div class="stat-label">Upcoming Events</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--success);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="teamMembersCount">0</div>
                            <div class="stat-label">Team Members</div>
                        </div>
                    </div>
                </div>

                <!-- Two Column Layout: My Tasks + Upcoming Events -->
                <div class="overview-two-col real-content">
                    <!-- My Tasks Section -->
                    <div class="overview-section overview-card">
                        <div class="overview-section-header">
                            <h2><i class="fas fa-tasks"></i> My Tasks</h2>
                            <button class="btn-link" onclick="switchTab('tasks')">View All ‚Üí</button>
                        </div>
                        <div id="overviewTasksList" class="overview-tasks">
                            <p style="text-align: center; color: var(--text-muted); padding: 20px;">No tasks assigned to you</p>
                        </div>
                    </div>

                    <!-- Upcoming Events Section -->
                    <div class="overview-section overview-card">
                        <div class="overview-section-header">
                            <h2><i class="fas fa-calendar-check"></i> Upcoming Events</h2>
                            <button class="btn-link" onclick="switchTab('calendar')">View Calendar ‚Üí</button>
                        </div>
                        <div id="overviewEventsList" class="overview-events">
                            <p style="text-align: center; color: var(--text-muted); padding: 20px;">No upcoming events</p>
                        </div>
                    </div>
                </div>

                <!-- Notifications Inbox Section - HIDDEN -->
                <div class="overview-section overview-notifications-section" style="display: none;">
                    <div class="overview-section-header">
                        <h2><i class="fas fa-bell"></i> Notifications</h2>
                        <div class="overview-notifications-actions">
                            <button class="btn-link" id="overviewMarkAllReadBtn" onclick="markAllNotificationsRead()">Mark all read</button>
                        </div>
                    </div>
                    <div id="overviewNotificationsList" class="overview-notifications-list">
                        <div class="no-notifications-overview">No notifications</div>
                    </div>
                </div>

                <!-- Link Lobby Section (moved above Recent Activity) -->
                <div class="overview-section link-lobby-section">
                    <div class="overview-section-header">
                        <h2><i class="fas fa-link"></i> Link Lobby</h2>
                        <button class="btn-primary btn-sm" id="addLinkGroupBtn">
                            <i class="fas fa-plus"></i> Group
                        </button>
                    </div>
                    <div class="link-lobby-container" id="linkLobbyContainer">
                        <!-- Link groups will be rendered here by JS -->
                        <div class="link-lobby-empty" id="linkLobbyEmpty">
                            <div class="link-lobby-empty-icon">
                                <i class="fas fa-folder-plus"></i>
                            </div>
                            <h3>No link groups yet</h3>
                            <p>Create a group to start organizing your links</p>
                            <button class="btn-primary" onclick="openAddGroupModal()">
                                <i class="fas fa-plus"></i> Group
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity Section -->
                <div class="overview-section">
                    <div class="overview-section-header">
                        <h2><i class="fas fa-history"></i> Recent Activity</h2>
                        <button id="seeAllActivitiesBtn" class="btn-link" style="display: none;">See All</button>
                    </div>
                    <div class="activity-feed" id="activityFeed">
                        <!-- Activities rendered by JS -->
                    </div>
                </div>
            </section>

            <!-- Team Section -->
            <section class="content-section" id="team-section">
                <div class="section-header">
                    <div class="section-header-content">
                        <h1>Team Management</h1>
                        <p class="section-subtitle">Manage your team members, view roles, and handle join requests</p>
                        <div id="currentUserRoleDisplay" style="margin-top: 8px; display: none;">
                            <span style="font-size: 14px; color: var(--text-muted);">Your role: </span>
                            <span id="currentUserRoleBadge" class="member-role-badge member">MEMBER</span>
                        </div>
                    </div>
                    <div class="section-header-actions">
                        <button class="btn-primary" id="joinTeamHeaderBtn" onclick="openJoinTeamModal()" style="display: none;">
                            <i class="fas fa-sign-in-alt"></i>
                            Join Team
                        </button>
                    </div>
                </div>

                <!-- Team Overview Card (shown when user has a team) -->
                <div id="teamOverviewCard" class="team-overview-card" style="display: none;">
                    <div class="team-overview-header">
                        <div class="team-overview-info">
                            <!-- Editable Team Name (Owner-only) -->
                            <div class="team-name-wrapper">
                                <h2 id="teamNameDisplay" class="team-name-text">My Team</h2>
                                <button id="editTeamNameBtn" class="btn-edit-team-name" title="Rename team" style="display: none;">
                                    <i class="fas fa-pen"></i>
                                </button>
                            </div>
                            <!-- Inline Edit Input (hidden by default) -->
                            <div id="teamNameEditWrapper" class="team-name-edit-wrapper" style="display: none;">
                                <input type="text" id="teamNameInput" class="team-name-input" maxlength="50" placeholder="Team name">
                                <button id="saveTeamNameBtn" class="btn-save-team-name" title="Save">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button id="cancelTeamNameBtn" class="btn-cancel-team-name" title="Cancel">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="team-meta">
                                <span class="team-code-display">
                                    <span id="teamCodeDisplay">------</span>
                                    <button class="btn-copy-code" onclick="copyTeamCode()" title="Copy team code">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                    <button class="btn-copy-code" onclick="generateJoinLink()" title="Copy join link">
                                        <i class="fas fa-link"></i>
                                    </button>
                                </span>
                                <span class="team-member-count">
                                    <i class="fas fa-users"></i>
                                    <span id="teamMemberCount">0</span> members
                                </span>
                            </div>
                        </div>
                        <div class="team-overview-actions">
                            <button class="btn-secondary btn-leave-team" id="leaveTeamBtn" onclick="leaveTeam()" style="display: none;">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Leave Team</span>
                            </button>
                        </div>
                    </div>

                    <!-- Pending Join Requests (shown for team members) -->
                    <div id="joinRequestsSection" class="join-requests-section" style="display: none;">
                        <div class="section-title">
                            <h3><i class="fas fa-inbox"></i> Join Requests</h3>
                            <span class="badge" id="requestCountBadge">0</span>
                        </div>
                        <div id="joinRequestsList" class="join-requests-list">
                            <!-- Join requests will be added here dynamically -->
                        </div>
                    </div>

                    <!-- Role Information - Collapsible Dropdown -->
                    <details id="roleInfoSection" class="role-info-card" style="display: none;">
                        <summary class="role-info-summary">
                            <i class="fas fa-shield-alt"></i>
                            <span>About Team Roles</span>
                            <i class="fas fa-chevron-down"></i>
                        </summary>
                        <div class="role-info-list">
                            <div class="role-info-item">
                                <div class="role-info-icon owner">
                                    <i class="fas fa-crown"></i>
                                </div>
                                <div class="role-info-content">
                                    <span class="role-info-name">Owner</span>
                                    <span class="role-info-desc">Full control: rename team, manage all members and roles</span>
                                </div>
                            </div>
                            <div class="role-info-item">
                                <div class="role-info-icon admin">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="role-info-content">
                                    <span class="role-info-name">Admin</span>
                                    <span class="role-info-desc">Invite members, approve requests, manage tasks & events</span>
                                </div>
                            </div>
                            <div class="role-info-item">
                                <div class="role-info-icon member">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="role-info-content">
                                    <span class="role-info-name">Member</span>
                                    <span class="role-info-desc">Chat, create tasks & events, view team info</span>
                                </div>
                            </div>
                        </div>
                    </details>

                    <!-- Team Members Grid -->
                    <div class="section-title">
                        <h3><i class="fas fa-users"></i> Team Members</h3>
                    </div>
                    <div class="team-members-grid" id="teamMembersGrid">
                        <!-- Team member cards will be added here dynamically -->
                    </div>

                    <!-- Pending Leave Requests (Admin Only) -->
                    <div id="pendingLeaveRequestsSection" class="pending-requests-section" style="display: none;">
                        <div class="section-title">
                            <h3><i class="fas fa-user-minus"></i> Pending Leave Requests</h3>
                        </div>
                        <div id="pendingLeaveRequestsList" class="pending-requests-list">
                            <!-- Leave requests will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- No Team State (shown when user doesn't have a team) -->
                <div id="noTeamCard" class="no-team-card" style="display: none;">
                    <div class="no-team-illustration">
                        <i class="fas fa-users-slash"></i>
                    </div>
                    <h2>You're not part of a team yet</h2>
                    <p>Create your own team or join an existing one with a team code</p>
                    
                    <div class="no-team-actions">
                        <div class="action-card">
                            <div class="action-icon">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <h3>Create a Team</h3>
                            <p>Start your own team and invite others to join</p>
                            <button class="btn-primary" onclick="createNewTeamNow()">
                                <i class="fas fa-plus"></i>
                                Create Team
                            </button>
                        </div>
                        
                        <div class="action-card">
                            <div class="action-icon">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <h3>Join a Team</h3>
                            <p>Enter a team code to join an existing team</p>
                            <div class="join-team-form">
                                <input type="text" id="joinTeamCodeInput" placeholder="TEAM-ABC123 or ABC123" maxlength="11" style="text-transform: uppercase;">
                                <button class="btn-primary" onclick="joinTeamWithCodeInput()">
                                    <i class="fas fa-arrow-right"></i>
                                    Join
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Chat Section -->
            <section class="content-section" id="chat-section">
                <!-- Skeleton Loading State -->
                <div class="skeleton-section" id="chat-skeleton">
                    <div style="padding: 16px;">
                        <div class="skeleton skeleton-title" style="width: 120px; margin-bottom: 24px;"></div>
                        <div class="skeleton-message">
                            <div class="skeleton skeleton-avatar"></div>
                            <div class="skeleton-message-content">
                                <div class="skeleton skeleton-text short"></div>
                                <div class="skeleton skeleton-text long"></div>
                            </div>
                        </div>
                        <div class="skeleton-message">
                            <div class="skeleton skeleton-avatar"></div>
                            <div class="skeleton-message-content">
                                <div class="skeleton skeleton-text short"></div>
                                <div class="skeleton skeleton-text medium"></div>
                            </div>
                        </div>
                        <div class="skeleton-message">
                            <div class="skeleton skeleton-avatar"></div>
                            <div class="skeleton-message-content">
                                <div class="skeleton skeleton-text short"></div>
                                <div class="skeleton skeleton-text long"></div>
                                <div class="skeleton skeleton-text medium"></div>
                            </div>
                        </div>
                        <div class="skeleton-message">
                            <div class="skeleton skeleton-avatar"></div>
                            <div class="skeleton-message-content">
                                <div class="skeleton skeleton-text short"></div>
                                <div class="skeleton skeleton-text medium"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section-header real-content" style="padding: 0; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                    <h1 style="margin: 0; font-size: 1.2rem;">Team Chat</h1>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <!-- Mentions filter toggle -->
                        <div class="chat-filter-toggle" id="chatFilterToggle">
                            <button class="filter-btn active" data-filter="all">All</button>
                            <button class="filter-btn" data-filter="mentions">@Me</button>
                        </div>
                        <button id="clearAllMessagesBtn" class="btn-secondary" style="display: none; padding: 6px 12px; font-size: 0.85rem;">
                            <i class="fas fa-trash-alt"></i> Clear All
                        </button>
                    </div>
                </div>
                
                <div class="chat-container real-content">
                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will be dynamically added here -->
                        <div class="message">
                            <div class="message-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-author">Sarah Chen</span>
                                    <span class="message-time">10:30 AM</span>
                                </div>
                                <div class="message-text">Hey team! The new design mockups are ready for review.</div>
                            </div>
                        </div>
                        
                        <div class="message">
                            <div class="message-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-author">Mike Johnson</span>
                                    <span class="message-time">10:35 AM</span>
                                </div>
                                <div class="message-text">Great! I'll take a look this afternoon.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-wrapper">
                        <!-- TYPING INDICATOR: Shows who is typing -->
                        <div class="typing-indicator" id="typingIndicator" style="display: none;">
                            <div class="typing-dots">
                                <span></span><span></span><span></span>
                            </div>
                            <span class="typing-text" id="typingText">Someone is typing...</span>
                        </div>
                        <!-- Mention dropdown - positioned above input -->
                        <div class="mention-dropdown" id="mentionDropdown" style="display: none;">
                            <!-- Mention items will be populated dynamically -->
                        </div>
                        <!-- Reply preview - compact pill above input -->
                        <div class="reply-preview" id="replyPreviewBar" style="display: none;">
                            <div class="reply-preview-indicator"></div>
                            <div class="reply-preview-info">
                                <span class="reply-preview-label">Replying to</span>
                                <span class="reply-preview-name" id="replyToName">Someone</span>
                                <span class="reply-preview-text" id="replyToPreview">Message preview...</span>
                            </div>
                            <button class="reply-preview-close" id="replyCancelBtn" title="Cancel reply">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="chat-input-container">
                            <button class="chat-emoji-btn" id="chatEmojiBtn" title="Insert emoji">
                                <i class="fas fa-smile"></i>
                            </button>
                            <input type="text" class="chat-input" id="chatInput" placeholder="Type a message... (use @ to mention, /r to reply)">
                            <button class="send-btn" id="sendMessageBtn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <!-- Chat Emoji Picker Popover -->
                        <div class="chat-emoji-popover" id="chatEmojiPopover" style="display: none;">
                            <div class="emoji-popover-header">
                                <input type="text" class="emoji-search-input" id="chatEmojiSearch" placeholder="Search emojis...">
                            </div>
                            <div class="emoji-category-tabs" id="chatEmojiCategoryTabs">
                                <button class="emoji-tab active" data-category="smileys" title="Smileys">üòÄ</button>
                                <button class="emoji-tab" data-category="people" title="People">üëã</button>
                                <button class="emoji-tab" data-category="nature" title="Nature">üê∂</button>
                                <button class="emoji-tab" data-category="food" title="Food">üçï</button>
                                <button class="emoji-tab" data-category="activities" title="Activities">‚öΩ</button>
                                <button class="emoji-tab" data-category="travel" title="Travel">üöó</button>
                                <button class="emoji-tab" data-category="objects" title="Objects">üí°</button>
                                <button class="emoji-tab" data-category="symbols" title="Symbols">‚ù§Ô∏è</button>
                            </div>
                            <div class="emoji-grid" id="chatEmojiGrid"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Calendar Section -->
            <section class="content-section" id="calendar-section">
                <!-- Skeleton Loading State -->
                <div class="skeleton-section" id="calendar-skeleton">
                    <div style="padding: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div class="skeleton" style="width: 150px; height: 32px; border-radius: 8px;"></div>
                            <div class="skeleton" style="width: 100px; height: 32px; border-radius: 8px;"></div>
                        </div>
                        <div class="skeleton-calendar-grid">
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                            <div class="skeleton skeleton-calendar-day"></div>
                        </div>
                    </div>
                </div>
                
                <div class="calendar-container real-content">
                    <div class="calendar-header">
                        <div class="calendar-title-section">
                            <button class="calendar-nav-btn" id="prevMonth">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            
                            <div class="calendar-month-selector">
                                <button class="calendar-month-trigger" id="calendarTitle">
                                    <span id="calendarTitleText">October 2025</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="calendar-month-dropdown" id="calendarMonthDropdown">
                                    <!-- Month/year options will be generated by JavaScript -->
                                </div>
                            </div>
                            
                            <button class="calendar-nav-btn" id="nextMonth">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        
                        <div class="calendar-header-actions">
                            <div class="calendar-view-toggle">
                                <button class="view-toggle-btn" data-view="week">Week</button>
                                <button class="view-toggle-btn active" data-view="month">Month</button>
                            </div>
                            <button class="calendar-add-btn" id="addEventBtn" title="Add Event">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="calendar-grid">
                        <div class="calendar-day-header">Mon</div>
                        <div class="calendar-day-header">Tue</div>
                        <div class="calendar-day-header">Wed</div>
                        <div class="calendar-day-header">Thu</div>
                        <div class="calendar-day-header">Fri</div>
                        <div class="calendar-day-header">Sat</div>
                        <div class="calendar-day-header">Sun</div>
                        <!-- Calendar days/week view will be dynamically generated -->
                        <div id="calendarDays"></div>
                    </div>
                </div>
            </section>

            <!-- Workspace Section -->
            <section class="content-section" id="tasks-section">
                <!-- Skeleton Loading State -->
                <div class="skeleton-section" id="tasks-skeleton">
                    <div style="padding: 0 24px;">
                        <div class="skeleton skeleton-title" style="width: 150px; margin-bottom: 8px;"></div>
                        <div class="skeleton skeleton-text short" style="margin-bottom: 24px;"></div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
                            <div class="skeleton-spreadsheet-card">
                                <div class="skeleton-spreadsheet-header">
                                    <div class="skeleton skeleton-spreadsheet-icon"></div>
                                    <div style="flex: 1;">
                                        <div class="skeleton skeleton-text medium"></div>
                                        <div class="skeleton skeleton-text short"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="skeleton-spreadsheet-card">
                                <div class="skeleton-spreadsheet-header">
                                    <div class="skeleton skeleton-spreadsheet-icon"></div>
                                    <div style="flex: 1;">
                                        <div class="skeleton skeleton-text medium"></div>
                                        <div class="skeleton skeleton-text short"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="skeleton-spreadsheet-card">
                                <div class="skeleton-spreadsheet-header">
                                    <div class="skeleton skeleton-spreadsheet-icon"></div>
                                    <div style="flex: 1;">
                                        <div class="skeleton skeleton-text medium"></div>
                                        <div class="skeleton skeleton-text short"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Workspace Header (shown when Workspace view active) -->
                <div class="spreadsheet-header" id="spreadsheetsViewHeader">
                    <div class="spreadsheet-header-left">
                        <h3><i class="fas fa-table-cells"></i> Your Sheets</h3>
                        <p class="spreadsheet-subtitle">Organize and track your team's work</p>
                        <!-- Toggle + Add button on one line (button right-aligned) -->
                        <div class="header-toggle-row">
                            <div class="sheets-docs-toggle">
                                <button class="toggle-btn active" data-view="sheets">
                                    <i class="fas fa-table-cells"></i> Sheets
                                </button>
                                <button class="toggle-btn" data-view="docs">
                                    <i class="fas fa-file-lines"></i> Docs
                                </button>
                            </div>
                            <button class="btn-primary" id="addTaskBtn">
                                <i class="fas fa-plus"></i> Row
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Project View Header (shown when viewing a specific project) -->
                <div class="spreadsheet-header project-view-header" id="projectViewHeader" style="display: none;">
                    <div class="spreadsheet-header-left">
                        <h3 id="projectViewTitle"><i class="fas fa-folder"></i> Project</h3>
                        <p class="spreadsheet-subtitle" id="projectViewSubtitle">Sheets and docs in this project</p>
                        <div class="header-toggle-row">
                            <button class="project-back-btn" id="projectBackBtn">
                                <i class="fas fa-arrow-left"></i>
                                <span>Projects</span>
                            </button>
                            <button class="btn-primary" id="projectAddBtn" title="New sheet or doc">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Spreadsheet Cards Grid -->
                <div class="spreadsheet-cards" id="spreadsheetCards">
                    <!-- Spreadsheet cards will be rendered by JS -->
                    <div class="spreadsheet-card create-new" id="createSpreadsheetCard">
                        <div class="spreadsheet-card-icon"><i class="fas fa-plus"></i></div>
                        <span>Create Spreadsheet</span>
                    </div>
                </div>

                <!-- Unified Project Empty State (when project has no sheets or docs) -->
                <div class="project-empty-state" id="projectEmptyState" style="display: none;">
                    <i class="fas fa-folder-open"></i>
                    <h4 id="projectEmptyTitle">No items in this project</h4>
                    <p>Create sheets or docs and assign them to this project</p>
                </div>

                <!-- Docs Header (shown when Docs view active) -->
                <div class="docs-header" id="docsViewHeader" style="display: none;">
                    <div class="docs-header-left">
                        <h3><i class="fas fa-file-lines"></i> Your Docs</h3>
                        <p class="docs-subtitle">Create and collaborate on documents</p>
                        <!-- Toggle + Add button on one line (button right-aligned) -->
                        <div class="header-toggle-row">
                            <div class="sheets-docs-toggle">
                                <button class="toggle-btn" data-view="sheets">
                                    <i class="fas fa-table-cells"></i> Sheets
                                </button>
                                <button class="toggle-btn active" data-view="docs">
                                    <i class="fas fa-file-lines"></i> Docs
                                </button>
                            </div>
                            <button class="btn-primary" id="createDocBtn" title="New sheet or doc">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Doc Cards Grid -->
                <div class="doc-cards" id="docCards" style="display: none;">
                    <!-- Doc cards will be rendered by JS -->
                    <div class="doc-card create-new" id="createDocCard">
                        <div class="doc-card-icon"><i class="fas fa-plus"></i></div>
                        <span>Create Doc</span>
                    </div>
                </div>

                <!-- Full-screen Spreadsheet Panel -->
                <div class="spreadsheet-panel" id="spreadsheetPanel">
                    <div class="spreadsheet-panel-header">
                        <div class="panel-header-left">
                            <button class="back-btn" id="spreadsheetBackBtn">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <button class="icon-btn" id="openSidebarBtn">
                                <i class="fas fa-columns"></i>
                            </button>
                            <div class="spreadsheet-title-group">
                                <div class="spreadsheet-icon-preview" id="spreadsheetIconPreview">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 7.5V18a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6.586a1 1 0 01-.707-.293l-1.414-1.414A1 1 0 009.586 5H5a2 2 0 00-2 2.5z"/></svg>
                                </div>
                                <input type="text" class="spreadsheet-title-input" value="All Tasks" placeholder="Spreadsheet name">
                            </div>
                        </div>
                        <div class="panel-header-right">
                            <button class="icon-btn" id="toggleCompletedBtn" title="Toggle completed tasks visibility">
                                <i class="fas fa-eye"></i>
                                <span id="toggleCompletedText">See all</span>
                            </button>
                            <button class="icon-btn icon-only primary" id="addTaskPanelBtn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Batch Actions Bar (hidden by default) -->
                    <div class="batch-actions-bar" id="batchActionsBar">
                        <div class="batch-info">
                            <span id="selectedCount">0</span> <span id="selectedItemsLabel">tasks</span> selected
                        </div>
                        <div class="batch-buttons">
                            <button class="batch-btn" onclick="batchMarkDone()">
                                <i class="fas fa-check"></i> Mark Done
                            </button>
                            <button class="batch-btn" onclick="batchChangeStatus()">
                                <i class="fas fa-sync"></i> Change Status
                            </button>
                            <button class="batch-btn danger" onclick="batchDelete()">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                        <button class="batch-close" onclick="clearSelection()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="spreadsheet-panel-body">
                        <!-- Column Toggle Sidebar -->
                        <div class="column-toggle-sidebar" id="columnSidebar">
                            <div class="sidebar-header">
                                <button class="add-column-btn" id="addColumnBtn" title="Add column">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <h4>Columns</h4>
                                <button class="sidebar-toggle" id="toggleSidebar">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                            </div>
                            <div class="sidebar-section">
                                <div class="column-toggles" id="columnToggles">
                                    <!-- Column toggles will be rendered by JS -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Spreadsheet Table Area -->
                        <div class="spreadsheet-table-area">
                            <div class="table-container" id="tableContainer">
                                <!-- Table will be rendered by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Full-screen Doc Panel -->
                <div class="doc-panel" id="docPanel">
                    <div class="doc-panel-header">
                        <div class="panel-header-left">
                            <button class="back-btn" id="docBackBtn">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <div class="doc-title-group">
                                <div class="doc-icon-preview">
                                    <i class="fas fa-file-lines"></i>
                                </div>
                                <input type="text" class="doc-title-input" id="docTitleInput" value="Untitled" placeholder="Doc title">
                            </div>
                        </div>
                        <div class="panel-header-right">
                            <span class="doc-save-status" id="docSaveStatus">Saved</span>
                        </div>
                    </div>
                    
                    <!-- Doc Editor Toolbar -->
                    <div class="doc-toolbar" id="docToolbar">
                        <div class="toolbar-group">
                            <div class="doc-format-dropdown-wrapper">
                                <button class="toolbar-btn doc-format-trigger" id="docFormatTrigger" title="Text Style">
                                    <span id="docFormatLabel">Normal</span>
                                    <i class="fas fa-chevron-down" style="font-size: 10px; margin-left: 4px;"></i>
                                </button>
                                <div class="doc-format-dropdown" id="docFormatDropdown">
                                    <div class="doc-format-option theme-btn" data-format="p">
                                        <span>Normal</span>
                                    </div>
                                    <div class="doc-format-option theme-btn" data-format="h1">
                                        <span style="font-size: 15px; font-weight: 600;">Heading 1</span>
                                    </div>
                                    <div class="doc-format-option theme-btn" data-format="h2">
                                        <span style="font-size: 14px; font-weight: 600;">Heading 2</span>
                                    </div>
                                    <div class="doc-format-option theme-btn" data-format="h3">
                                        <span style="font-size: 13px; font-weight: 600;">Heading 3</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" data-command="bold" title="Bold (Ctrl+B)">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button class="toolbar-btn" data-command="italic" title="Italic (Ctrl+I)">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button class="toolbar-btn" data-command="underline" title="Underline (Ctrl+U)">
                                <i class="fas fa-underline"></i>
                            </button>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" data-command="justifyLeft" title="Align Left">
                                <i class="fas fa-align-left"></i>
                            </button>
                            <button class="toolbar-btn" data-command="justifyCenter" title="Align Center">
                                <i class="fas fa-align-center"></i>
                            </button>
                            <button class="toolbar-btn" data-command="justifyRight" title="Align Right">
                                <i class="fas fa-align-right"></i>
                            </button>
                            <button class="toolbar-btn" data-command="justifyFull" title="Justify">
                                <i class="fas fa-align-justify"></i>
                            </button>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" data-command="insertUnorderedList" title="Bullet List">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button class="toolbar-btn" data-command="insertOrderedList" title="Numbered List">
                                <i class="fas fa-list-ol"></i>
                            </button>
                            <button class="toolbar-btn" data-command="outdent" title="Decrease Indent (Shift+Tab)">
                                <i class="fas fa-outdent"></i>
                            </button>
                            <button class="toolbar-btn" data-command="indent" title="Increase Indent (Tab)">
                                <i class="fas fa-indent"></i>
                            </button>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" id="insertLinkBtn" title="Insert Link">
                                <i class="fas fa-link"></i>
                            </button>
                            <button class="toolbar-btn" id="insertCommandBtn" title="Insert Reference (/)">
                                <i class="fas fa-plus-circle"></i>
                            </button>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" id="exportDocBtn" title="Export Document">
                                <i class="fas fa-download"></i>
                                <span class="toolbar-btn-label">Export</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Command Popover (hidden by default) -->
                    <div class="doc-command-popover" id="docCommandPopover" style="display: none;">
                        <div class="command-option" data-command="task-ref">
                            <i class="fas fa-check-circle"></i>
                            <div class="command-option-text">
                                <span class="command-option-title">Task Reference</span>
                                <span class="command-option-desc">Insert a task chip</span>
                            </div>
                        </div>
                        <div class="command-option" data-command="sheet-ref">
                            <i class="fas fa-table"></i>
                            <div class="command-option-text">
                                <span class="command-option-title">Sheet Reference</span>
                                <span class="command-option-desc">Insert a sheet chip</span>
                            </div>
                        </div>
                        <div class="command-option" data-command="sheet-embed">
                            <i class="fas fa-table-cells"></i>
                            <div class="command-option-text">
                                <span class="command-option-title">Embed Sheet</span>
                                <span class="command-option-desc">Read-only preview</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Doc Emoji Picker Popover -->
                    <div class="doc-emoji-popover" id="docEmojiPopover" style="display: none;">
                        <div class="emoji-popover-header">
                            <input type="text" class="emoji-search-input" id="docEmojiSearch" placeholder="Search emojis...">
                        </div>
                        <div class="emoji-category-tabs" id="emojiCategoryTabs">
                            <button class="emoji-tab active" data-category="smileys" title="Smileys">üòÄ</button>
                            <button class="emoji-tab" data-category="people" title="People">üëã</button>
                            <button class="emoji-tab" data-category="nature" title="Nature">üê∂</button>
                            <button class="emoji-tab" data-category="food" title="Food">üçï</button>
                            <button class="emoji-tab" data-category="activities" title="Activities">‚öΩ</button>
                            <button class="emoji-tab" data-category="travel" title="Travel">üöó</button>
                            <button class="emoji-tab" data-category="objects" title="Objects">üí°</button>
                            <button class="emoji-tab" data-category="symbols" title="Symbols">‚ù§Ô∏è</button>
                        </div>
                        <div class="emoji-grid" id="docEmojiGrid"></div>
                    </div>
                    
                    <!-- Doc Editor Body -->
                    <div class="doc-panel-body">
                        <div class="doc-main-layout">
                            <div class="doc-editor-container">
                                <div class="doc-editor" id="docEditor" contenteditable="true" data-placeholder="Start writing..."></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Metrics Section -->
            <section class="content-section" id="metrics-section">
                <div class="section-header">
                    <div>
                        <h1>Metrics</h1>
                        <p class="section-subtitle">Track performance across tasks, events and teamwork.</p>
                    </div>
                    <!-- Date range / user selector filters will be added later -->
                </div>
                <div id="metricsContent" class="metrics-layout">
                    <!-- Metrics cards & charts will be rendered here by JS -->
                    <div class="metrics-placeholder-state">
                        <div class="metrics-placeholder-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Performance Metrics</h3>
                        <p>Track your team's productivity, task completion rates, and activity trends.</p>
                    </div>
                </div>
            </section>

            <!-- Finances Section -->
            <section class="content-section" id="finances-section">
                <div class="section-header">
                    <div>
                        <h1>Finances</h1>
                        <p class="section-subtitle">Track revenue, expenses, and financial metrics.</p>
                    </div>
                </div>
                
                <!-- Finances Summary Cards - Top Metrics -->
                <div class="finances-metrics-row" id="financesSummary">
                    <div class="finance-metric-card">
                        <div class="finance-metric-icon mrr">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="finance-metric-content">
                            <span class="finance-metric-label">MRR</span>
                            <span class="finance-metric-value" id="mrrValue">$0.00</span>
                            <span class="finance-metric-sub">Monthly Recurring Revenue</span>
                        </div>
                    </div>
                    <div class="finance-metric-card">
                        <div class="finance-metric-icon ytd">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="finance-metric-content">
                            <span class="finance-metric-label">YTD Revenue</span>
                            <span class="finance-metric-value income" id="ytdIncomeValue">$0.00</span>
                            <span class="finance-metric-sub">Year to date</span>
                        </div>
                    </div>
                    <div class="finance-metric-card">
                        <div class="finance-metric-icon net">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <div class="finance-metric-content">
                            <span class="finance-metric-label">Net Balance</span>
                            <span class="finance-metric-value" id="netBalanceValue">$0.00</span>
                            <span class="finance-metric-sub">Income - Expenses</span>
                        </div>
                    </div>
                    <div class="finance-metric-card">
                        <div class="finance-metric-icon customer">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="finance-metric-content">
                            <span class="finance-metric-label">Main Customer</span>
                            <span class="finance-metric-value customer-name" id="mainCustomerValue">‚Äî</span>
                            <span class="finance-metric-sub" id="mainCustomerTotal">No data yet</span>
                        </div>
                    </div>
                </div>

                <!-- Mobile Revenue/Expenses Toggle (only visible on mobile) -->
                <div class="finance-mobile-toggle" id="financeMobileToggle">
                    <button class="toggle-btn active" data-view="revenue">
                        <i class="fas fa-arrow-up"></i> Revenue
                    </button>
                    <button class="toggle-btn" data-view="expenses">
                        <i class="fas fa-arrow-down"></i> Expenses
                    </button>
                </div>

                <!-- Two-Column Layout: Revenue & Expenses -->
                <div class="finances-columns" id="financesContent">
                    <!-- Revenue Column (Left) -->
                    <div class="finance-column revenue-column">
                        <div class="finance-column-header">
                            <div class="column-title">
                                <span class="column-icon income"><i class="fas fa-arrow-up"></i></span>
                                <h2>Revenue</h2>
                                <span class="column-total" id="revenueTotalBadge">$0.00</span>
                            </div>
                            <button class="btn-add-transaction income" id="addRevenueBtn" title="Add Revenue">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="transactions-column-list" id="revenueList">
                            <!-- Revenue transactions rendered here -->
                        </div>
                        <div class="finance-column-footer" id="revenueFooter" style="display: none;">
                            <button class="see-all-btn" id="revenueSeaAllBtn" onclick="toggleSeeAll('revenue')">
                                <span>See All</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        <div class="column-empty-state" id="revenueEmptyState">
                            <i class="fas fa-coins"></i>
                            <p>No revenue recorded yet</p>
                            <button class="btn-text income" id="addFirstRevenueBtn">
                                <i class="fas fa-plus"></i> Revenue
                            </button>
                        </div>
                    </div>

                    <!-- Expenses Column (Right) -->
                    <div class="finance-column expenses-column">
                        <div class="finance-column-header">
                            <div class="column-title">
                                <span class="column-icon expense"><i class="fas fa-arrow-down"></i></span>
                                <h2>Expenses</h2>
                                <span class="column-total expense" id="expensesTotalBadge">$0.00</span>
                            </div>
                            <button class="btn-add-transaction expense" id="addExpenseBtn" title="Add Expense">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="transactions-column-list" id="expensesList">
                            <!-- Expense transactions rendered here -->
                        </div>
                        <div class="finance-column-footer" id="expensesFooter" style="display: none;">
                            <button class="see-all-btn" id="expensesSeaAllBtn" onclick="toggleSeeAll('expenses')">
                                <span>See All</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        <div class="column-empty-state" id="expensesEmptyState">
                            <i class="fas fa-receipt"></i>
                            <p>No expenses recorded yet</p>
                            <button class="btn-text expense" id="addFirstExpenseBtn">
                                <i class="fas fa-plus"></i> Expense
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Customers Section -->
                <div class="customers-section" id="customersSection">
                    <div class="customers-header">
                        <div class="customers-title">
                            <span class="customers-icon"><i class="fas fa-user-tie"></i></span>
                            <h2>Customers</h2>
                            <span class="customers-count" id="customersCount">0</span>
                        </div>
                        <button class="btn-add-customer" id="addCustomerBtn" title="Add Customer">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>

                    <!-- Customer Search -->
                    <div class="customers-search-row" id="customersSearchRow" style="display: none;">
                        <div class="customers-search-wrapper">
                            <i class="fas fa-search"></i>
                            <input type="text" class="customers-search-input" id="customerSearchInput" placeholder="Search customers...">
                        </div>
                    </div>

                    <!-- Customers List -->
                    <div class="customers-list" id="customersList">
                        <!-- Rendered by JS -->
                    </div>

                    <!-- Empty State -->
                    <div class="customers-empty-state" id="customersEmptyState" style="display: none;">
                        <i class="fas fa-user-tie"></i>
                        <p>No customers yet</p>
                        <span class="customers-empty-hint">Add customers manually or they'll be created automatically when leads are won.</span>
                        <button class="add-row-btn" id="addFirstCustomerBtn">
                            <i class="fas fa-plus"></i> Customer
                        </button>
                    </div>
                </div>

                <!-- Subscriptions Section -->
                <div class="subscriptions-section" id="subscriptionsSection">
                    <div class="subscriptions-header">
                        <div class="subscriptions-title">
                            <span class="subscriptions-icon"><i class="fas fa-calendar-check"></i></span>
                            <h2>Subscriptions</h2>
                            <span class="subscriptions-count" id="subscriptionsCount">0</span>
                        </div>
                    </div>
                    
                    <!-- Subscriptions Tabs -->
                    <div class="subscriptions-tabs-row">
                        <div class="subscriptions-tabs" id="subscriptionsTabs">
                            <button class="sub-tab active" data-tab="company">
                                <i class="fas fa-building"></i> Company
                                <span class="sub-tab-count" id="companySubsCount">0</span>
                            </button>
                            <button class="sub-tab" data-tab="private">
                                <i class="fas fa-user-secret"></i> Private
                                <span class="sub-tab-count" id="privateSubsCount">0</span>
                            </button>
                        </div>
                        <button class="btn-add-subscription" id="addSubscriptionBtn" title="Add Subscription">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    
                    <!-- Upcoming Subscriptions Banner -->
                    <div class="upcoming-subscriptions" id="upcomingSubscriptions">
                        <!-- Rendered by JS -->
                    </div>
                    
                    <!-- Subscriptions List -->
                    <div class="subscriptions-list" id="subscriptionsList">
                        <!-- Rendered by JS -->
                    </div>
                    
                    <!-- Empty State -->
                    <div class="subscriptions-empty-state" id="subscriptionsEmptyState" style="display: none;">
                        <i class="fas fa-calendar-check"></i>
                        <p>No subscriptions yet</p>
                        <button class="add-row-btn" id="addFirstSubscriptionBtn">
                            <i class="fas fa-plus"></i> Subscription
                        </button>
                    </div>
                </div>

                <!-- Full-page empty state (when no transactions at all) -->
                <div class="finances-placeholder-state" id="financesPlaceholder" style="display: none;">
                    <div class="finances-placeholder-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <h3>No Transactions Yet</h3>
                    <p>Start tracking your finances by adding your first transaction.</p>
                    <div class="placeholder-actions">
                        <button class="btn-primary income" id="addFirstTransactionBtnRevenue">
                            <i class="fas fa-plus"></i> Revenue
                        </button>
                        <button class="btn-secondary expense" id="addFirstTransactionBtnExpense">
                            <i class="fas fa-plus"></i> Expense
                        </button>
                    </div>
                </div>
            </section>

            <!-- Settings Section - Minimalist Design -->
            <section class="content-section" id="settings-section">
                <div class="settings-page-layout">
                    <!-- Settings Main Content -->
                    <div class="settings-main-content">
                        <!-- Settings Header -->
                        <div class="settings-page-header">
                            <h1 class="settings-page-title">Settings</h1>
                        </div>

                        <!-- Settings Tab Navigation -->
                        <div class="settings-tabs-nav">
                            <button class="settings-tab active" data-settings-tab="profile">Profile</button>
                            <button class="settings-tab" data-settings-tab="achievements" id="achievementsSettingsTab">Achievements</button>
                            <button class="settings-tab" data-settings-tab="appearance">Appearance</button>
                            <button class="settings-tab" data-settings-tab="notifications">Notifications</button>
                            <button class="settings-tab" data-settings-tab="security">Security</button>
                            <button class="settings-tab" data-settings-tab="help">Help</button>
                            <button class="settings-tab" data-settings-tab="advanced" id="advancedSettingsTab" style="display: none;">Advanced</button>
                        </div>

                        <!-- Settings Tab Content -->
                        <div class="settings-tab-content">
                            
                            <!-- Profile Tab -->
                            <div class="settings-tab-pane active" id="settings-pane-profile">
                                <form id="accountSettingsForm" class="settings-minimal-form">
                                    <!-- Avatar & Name Row -->
                                    <div class="settings-profile-header">
                                        <div class="settings-avatar-compact" id="avatarDropzone">
                                            <div class="profile-avatar-large" id="profileAvatarPreview">
                                                <span id="profileAvatarText">JD</span>
                                            </div>
                                            <div class="avatar-edit-overlay">
                                                <i class="fas fa-camera"></i>
                                            </div>
                                            <input type="file" id="avatarFileInputInline" accept="image/*" class="dropzone-input">
                                        </div>
                                        <div class="settings-name-fields">
                                            <input type="text" id="settingsDisplayName" placeholder="Display name" required class="settings-input-minimal settings-input-lg">
                                            <input type="text" id="settingsJobTitle" placeholder="Job title" class="settings-input-minimal">
                                        </div>
                                    </div>

                                    <!-- Email (readonly) -->
                                    <div class="settings-field-minimal">
                                        <label>Email</label>
                                        <input type="email" id="settingsEmail" readonly disabled class="settings-input-minimal settings-input-disabled">
                                    </div>

                                    <!-- Avatar Color -->
                                    <div class="settings-field-minimal">
                                        <label>Avatar Color</label>
                                        <div class="color-picker-inline preset-only" id="avatarColorPicker" data-picker="avatar" data-input="settingsAvatarColor" data-swatch="avatarColorSwatch">
                                            <div class="color-picker-inner-pill">
                                                <div class="color-picker-current-swatch" id="avatarColorSwatch" style="background: #0A84FF;"></div>
                                            </div>
                                            <div class="color-picker-recent">
                                                <button type="button" class="color-picker-recent-btn" data-color="#EF4444" style="background: #EF4444;"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="#EC4899" style="background: #EC4899;"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="#8B5CF6" style="background: #8B5CF6;"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="rgb(127, 211, 255)" style="background: rgb(127, 211, 255);"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="#0A84FF" style="background: #0A84FF;"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="#14B8A6" style="background: #14B8A6;"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="#22C55E" style="background: #22C55E;"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="#F59E0B" style="background: #F59E0B;"></button>
                                            </div>
                                        </div>
                                            <input type="hidden" id="settingsAvatarColor" value="#0A84FF">
                                        <input type="hidden" id="avatarFileInput" accept="image/*">
                                    </div>

                                    <!-- Save Button -->
                                    <div class="settings-actions-minimal settings-actions-right">
                                        <button type="submit" class="settings-btn-save btn-primary">Save Changes</button>
                                    </div>
                                </form>
                            </div>

                            <!-- Appearance Tab -->
                            <div class="settings-tab-pane" id="settings-pane-appearance">
                                <form id="appearanceForm" class="settings-minimal-form">
                                    <!-- Theme -->
                                    <div class="settings-field-minimal">
                                        <label>Theme</label>
                                        <div class="theme-selector-minimal">
                                            <button type="button" class="theme-btn" data-theme="system">
                                                <i class="fas fa-laptop"></i> System
                                            </button>
                                            <button type="button" class="theme-btn" data-theme="light">
                                                <i class="fas fa-sun"></i> Light
                                            </button>
                                            <button type="button" class="theme-btn" data-theme="dark">
                                                <i class="fas fa-moon"></i> Dark
                                            </button>
                                        </div>
                                        <input type="hidden" id="themePreference" value="system">
                                    </div>

                                    <!-- Accent Color -->
                                    <div class="settings-field-minimal">
                                        <label>Accent Color</label>
                                        <div class="color-picker-inline preset-only" id="accentColorPicker" data-picker="accent" data-swatch="accentColorSwatch">
                                            <div class="color-picker-inner-pill">
                                                <div class="color-picker-current-swatch" id="accentColorSwatch" style="background: #0A84FF;"></div>
                                            </div>
                                            <div class="color-picker-recent">
                                                <button type="button" class="color-picker-recent-btn selected" data-color="#0A84FF" data-accent="blue" style="background: #0A84FF;"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="#14B8A6" data-accent="teal" style="background: #14B8A6;"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="#22C55E" data-accent="green" style="background: #22C55E;"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="#8B5CF6" data-accent="purple" style="background: #8B5CF6;"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="#EF4444" data-accent="red" style="background: #EF4444;"></button>
                                                <button type="button" class="color-picker-recent-btn" data-color="#F59E0B" data-accent="orange" style="background: #F59E0B;"></button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Sidebar Icons -->
                                    <div class="settings-row-minimal">
                                        <span>Show sidebar icons</span>
                                        <label class="toggle-minimal">
                                            <input type="checkbox" id="showSidebarIcons" checked>
                                            <span class="toggle-track"></span>
                                        </label>
                                    </div>
                                </form>
                            </div>

                            <!-- Notifications Tab -->
                            <div class="settings-tab-pane" id="settings-pane-notifications">
                                <form id="notificationsForm" class="settings-minimal-form">
                                    <!-- Push Notifications Section -->
                                    <div class="settings-group-label">Push Notifications</div>
                                    <div class="settings-row-minimal" id="pushNotificationRow">
                                        <div class="push-notif-info">
                                            <span>Enable push notifications</span>
                                            <span class="push-notif-status" id="pushNotifStatus">Not enabled</span>
                                        </div>
                                        <button type="button" class="settings-btn-outline" id="enablePushBtn" onclick="requestPushPermission()">
                                            <i class="fas fa-bell"></i> Enable
                                        </button>
                                    </div>

                                    <div class="settings-group-label">Tasks</div>
                                    <div class="settings-row-minimal">
                                        <span>Assigned to you</span>
                                        <label class="toggle-minimal"><input type="checkbox" id="notifTaskAssigned" checked><span class="toggle-track"></span></label>
                                    </div>
                                    <div class="settings-row-minimal">
                                        <span>Task updates</span>
                                        <label class="toggle-minimal"><input type="checkbox" id="notifTaskUpdated" checked><span class="toggle-track"></span></label>
                                    </div>
                                    <div class="settings-row-minimal">
                                        <span>Completed tasks</span>
                                        <label class="toggle-minimal"><input type="checkbox" id="notifTaskCompleted"><span class="toggle-track"></span></label>
                                    </div>

                                    <div class="settings-group-label">Chat</div>
                                    <div class="settings-row-minimal">
                                        <span>Mentions</span>
                                        <label class="toggle-minimal"><input type="checkbox" id="notifChatMentions" checked><span class="toggle-track"></span></label>
                                    </div>
                                    <div class="settings-row-minimal">
                                        <span>Replies</span>
                                        <label class="toggle-minimal"><input type="checkbox" id="notifChatReplies" checked><span class="toggle-track"></span></label>
                                    </div>

                                    <div class="settings-group-label">Team</div>
                                    <div class="settings-row-minimal">
                                        <span>New members</span>
                                        <label class="toggle-minimal"><input type="checkbox" id="notifTeamMembers" checked><span class="toggle-track"></span></label>
                                    </div>
                                    <div class="settings-row-minimal">
                                        <span>Settings changes</span>
                                        <label class="toggle-minimal"><input type="checkbox" id="notifTeamChanges"><span class="toggle-track"></span></label>
                                    </div>
                                </form>
                            </div>

                            <!-- Security Tab -->
                            <div class="settings-tab-pane" id="settings-pane-security">
                                <div class="settings-minimal-form">
                                    <div class="settings-action-row">
                                        <div class="action-info">
                                            <span class="action-title">Reset Password</span>
                                            <span class="action-desc">Send a reset link to your email</span>
                                        </div>
                                        <button type="button" class="settings-btn-outline" onclick="sendPasswordResetFromSettings()">Send Link</button>
                                    </div>

                                    <div class="settings-action-row">
                                        <div class="action-info">
                                            <span class="action-title">Sign Out Everywhere</span>
                                            <span class="action-desc">Log out of all devices</span>
                                        </div>
                                        <button type="button" class="settings-btn-outline danger" onclick="showLogoutAllModal()">Sign Out</button>
                                    </div>

                                    <div class="settings-action-row" id="deleteChatHistorySection" style="display: none;">
                                        <div class="action-info">
                                            <span class="action-title">Delete Chat History</span>
                                            <span class="action-desc danger">Permanently delete all messages</span>
                                        </div>
                                        <button type="button" class="settings-btn-outline danger" onclick="showDeleteChatHistoryModal()">Delete</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Advanced Tab (Admin/Owner Only) -->
                            <!-- Help Tab -->
                            <div class="settings-tab-pane" id="settings-pane-help">
                                <div class="settings-minimal-form">
                                    <div class="settings-group-label">Keyboard Shortcuts</div>
                                    
                                    <div style="margin-bottom: 32px;">
                                        <div style="font-weight: 500; margin-bottom: 12px; color: var(--text-primary);">Global Shortcuts</div>
                                        <div style="display: flex; flex-direction: column; gap: 8px;">
                                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                                <span style="color: var(--text-secondary);">Create new task</span>
                                                <kbd style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 13px;">T</kbd>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                                <span style="color: var(--text-secondary);">Create new event</span>
                                                <kbd style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 13px;">E</kbd>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                                <span style="color: var(--text-secondary);">Focus chat input</span>
                                                <kbd style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 13px;">M</kbd>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                                <span style="color: var(--text-secondary);">Open search</span>
                                                <kbd style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 13px;">/</kbd>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                                <span style="color: var(--text-secondary);">Close modal/dialog</span>
                                                <kbd style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 13px;">Esc</kbd>
                                            </div>
                                        </div>
                                    </div>

                                    <div style="margin-bottom: 32px;">
                                        <div style="font-weight: 500; margin-bottom: 12px; color: var(--text-primary);">Doc Editor Shortcuts</div>
                                        <div style="display: flex; flex-direction: column; gap: 8px;">
                                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                                <span style="color: var(--text-secondary);">Insert command (task/sheet reference or embed)</span>
                                                <kbd style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 13px;">/</kbd>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                                <span style="color: var(--text-secondary);">Insert emoji</span>
                                                <kbd style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 13px;">#</kbd>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                                <span style="color: var(--text-secondary);">Close popover</span>
                                                <kbd style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 13px;">Esc</kbd>
                                            </div>
                                        </div>
                                    </div>

                                    <div style="margin-bottom: 32px;">
                                        <div style="font-weight: 500; margin-bottom: 12px; color: var(--text-primary);">Chat Shortcuts</div>
                                        <div style="display: flex; flex-direction: column; gap: 8px;">
                                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                                <span style="color: var(--text-secondary);">Send message</span>
                                                <kbd style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 13px;">Enter</kbd>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                                <span style="color: var(--text-secondary);">New line in message</span>
                                                <kbd style="background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 13px;">Shift + Enter</kbd>
                                            </div>
                                        </div>
                                    </div>

                                    <div style="padding: 16px; background: var(--bg-secondary); border-radius: 8px; margin-top: 24px;">
                                        <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.6;">
                                            <strong style="color: var(--text-primary);">Note:</strong> Global shortcuts (T, E, M, /) work anywhere in the app except when typing in input fields or when modals are open.
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Achievements Tab -->
                            <div class="settings-tab-pane" id="settings-pane-achievements">
                                <div class="settings-minimal-form">
                                    <!-- XP & Streak Hero Section - 2 Column Layout -->
                                    <div class="achievements-hero-grid">
                                        <!-- XP Section -->
                                        <div class="achievements-xp-section">
                                            <div class="xp-info">
                                                <div class="xp-level-text">Level <span id="userLevel" class="level-number-blue">1</span></div>
                                                <div class="xp-progress-container">
                                                    <div class="xp-progress-bar" id="xpProgressBar" style="width: 0%"></div>
                                                </div>
                                                <div class="xp-text"><span id="currentXP">0</span>/<span id="nextLevelXP">100</span>xp</div>
                                            </div>
                                        </div>
                                        
                                        <!-- Streak Section -->
                                        <div class="achievements-streak-section">
                                            <div class="streak-fire-icon">
                                                <i class="fas fa-fire"></i>
                                                <span class="streak-number" id="streakCount">0</span>
                                            </div>
                                            <div class="streak-info">
                                                <div class="streak-label">Day Streak</div>
                                                <div class="best-streak">best: <span id="bestStreak">0</span> days</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Badges Section -->
                                    <div class="settings-group-label" style="margin-top: 24px;">Badges</div>
                                    <div id="achievementsBadgesContainer" class="achievements-badges-container">
                                        <!-- Badges will be rendered here by JS -->
                                    </div>

                                    <!-- Stats Section -->
                                    <div class="settings-group-label" style="margin-top: 24px;">Your Stats</div>
                                    <div class="achievements-stats-list" id="achievementsStatsList">
                                        <!-- Stats will be rendered by JS -->
                                    </div>
                                    <div class="achievements-recalc-row" style="margin-top: 16px; display: flex; justify-content: flex-end;">
                                        <button type="button" class="unified-btn unified-btn-secondary" id="recalculateXpBtn">Recalculate XP (Temp)</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Advanced Tab -->
                            <div class="settings-tab-pane" id="settings-pane-advanced">
                                <div class="settings-minimal-form">
                                    <!-- Gamification Settings -->
                                    <div class="settings-group-label">Gamification</div>
                                    <form id="gamificationForm">
                                        <div class="settings-row-minimal">
                                            <div>
                                                <span>Enable achievements</span>
                                                <div class="settings-row-hint">XP, levels, and badges for completing work</div>
                                            </div>
                                            <label class="toggle-minimal"><input type="checkbox" id="gamificationEnabled" checked><span class="toggle-track"></span></label>
                                        </div>
                                    </form>

                                    <!-- Chat Settings -->
                                    <div class="settings-group-label" style="margin-top: 24px;">Chat</div>
                                    <form id="chatAppearanceForm">
                                        <div class="settings-row-minimal">
                                            <span>Show avatars</span>
                                            <label class="toggle-minimal"><input type="checkbox" id="chatShowAvatars" checked><span class="toggle-track"></span></label>
                                        </div>
                                        <div class="settings-row-minimal">
                                            <span>Compact chat layout</span>
                                            <label class="toggle-minimal"><input type="checkbox" id="chatCompactMode"><span class="toggle-track"></span></label>
                                        </div>
                                        <div class="settings-row-minimal">
                                            <span>Timestamp style</span>
                                            <div class="mini-radio-group">
                                                <label class="mini-radio"><input type="radio" name="timestampStyle" value="inline" checked><span>Inline</span></label>
                                                <label class="mini-radio"><input type="radio" name="timestampStyle" value="subtle"><span>Subtle</span></label>
                                            </div>
                                        </div>
                                        <div class="settings-row-minimal">
                                            <span>Bubble style</span>
                                            <div class="mini-radio-group">
                                                <label class="mini-radio"><input type="radio" name="bubbleStyle" value="filled" checked><span>Filled</span></label>
                                                <label class="mini-radio"><input type="radio" name="bubbleStyle" value="minimal"><span>Outline</span></label>
                                            </div>
                                        </div>
                                    </form>

                                    <!-- Animations -->
                                    <div class="settings-group-label" style="margin-top: 24px;">System</div>
                                    <form id="animationsForm">
                                        <div class="settings-row-minimal">
                                            <span>Enable animations</span>
                                            <label class="toggle-minimal"><input type="checkbox" id="enableAnimations" checked><span class="toggle-track"></span></label>
                                        </div>
                                    </form>

                                    <!-- Metrics (Owner Only) -->
                                    <div id="metricsSettingsCard" style="display: none;">
                                        <div class="settings-group-label" style="margin-top: 24px;">Metrics Visibility</div>
                                        <form id="metricsVisibilityForm">
                                            <div class="settings-select-minimal">
                                                <select name="metricsVisibility" id="metricsVisibilitySelect">
                                                    <option value="owner-only">Owner only</option>
                                                    <option value="admin-owner">Owner & Admins</option>
                                                    <option value="members-own">Members see own</option>
                                                    <option value="everyone">Everyone</option>
                                                </select>
                                            </div>
                                        </form>
                                    </div>

                                    <!-- Finances (Owner Only) -->
                                    <div id="financesSettingsCard" style="display: none;">
                                        <div class="settings-group-label" style="margin-top: 24px;">Finances</div>
                                        <form id="financesVisibilityForm">
                                            <div class="settings-row-minimal">
                                                <span>Enable finances tab</span>
                                                <label class="toggle-minimal"><input type="checkbox" name="financesEnabled" id="financesEnabledToggle"><span class="toggle-track"></span></label>
                                            </div>
                                            <div id="financesVisibilityOptions">
                                                <div class="settings-select-minimal" style="margin-top: 12px;">
                                                    <select name="financesVisibility" id="financesVisibilitySelect">
                                                        <option value="owner-only">Owner only</option>
                                                        <option value="admin-owner">Owner & Admins</option>
                                                        <option value="everyone">Everyone</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-footer">
                            <div class="footer-brand">
                                <span>Made with <span class="heart-icon"><i class="fas fa-heart"></i></span> by <a href="https://rootlabs.studio" target="_blank" rel="noopener">Root Labs</a></span>
                            </div>
                            <div class="footer-links">
                                <a href="https://rootlabs.studio" target="_blank" rel="noopener" aria-label="Root Labs website"><i class="fas fa-globe"></i></a>
                                <a href="https://www.instagram.com/rootlabs.studio" target="_blank" rel="noopener" aria-label="Root Labs Instagram"><i class="fab fa-instagram"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>


        </main>
    </div>

    <!-- Modal for Logout All Devices - Unified Style -->
    <div class="unified-modal" id="logoutAllModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-shield-halved"></i> Log Out Everywhere</h2>
                </div>
                <button class="unified-modal-close" id="closeLogoutAllModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box warning">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-power-off"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Sign out from all devices?</p>
                        <p class="unified-confirm-text">
                            You will be signed out from all devices and browsers where you're currently logged in, including this one.
                        </p>
                        <p class="unified-confirm-text mt-sm">
                            You'll need to sign in again on each device you want to use.
                        </p>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" id="cancelLogoutAll">Cancel</button>
                <button class="unified-btn unified-btn-danger" id="confirmLogoutAll">
                    <i class="fas fa-power-off"></i> Log Out Everywhere
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Delete Chat History - Unified Style -->
    <div class="unified-modal" id="deleteChatHistoryModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-trash-alt"></i> Delete Chat History</h2>
                </div>
                <button class="unified-modal-close" id="closeDeleteChatHistoryModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box danger">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title danger">‚ö†Ô∏è PERMANENT ACTION</p>
                        <p class="unified-confirm-text">
                            This will permanently delete all team messages.
                        </p>
                        <p class="unified-confirm-text danger mt-sm">
                            This action cannot be undone.
                        </p>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" id="cancelDeleteChatHistory">Cancel</button>
                <button class="unified-btn unified-btn-danger" id="confirmDeleteChatHistory">
                    <i class="fas fa-trash-alt"></i> Delete All Messages
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Promoting Member - Unified Style -->
    <div class="unified-modal" id="promoteModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-arrow-up"></i> Promote to Admin</h2>
                </div>
                <button class="unified-modal-close" onclick="closePromoteModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box info">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Promote <strong id="promoteMemberName"></strong> to Admin?</p>
                        <p class="unified-confirm-text">Admins have elevated permissions in the team.</p>
                        <ul class="unified-feature-list">
                            <li><i class="fas fa-check"></i> Invite new members</li>
                            <li><i class="fas fa-check"></i> Approve/deny join requests</li>
                            <li><i class="fas fa-check"></i> Manage tasks and events</li>
                            <li class="muted"><i class="fas fa-times"></i> Cannot change owner or other admin roles</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" onclick="closePromoteModal()">Cancel</button>
                <button class="unified-btn unified-btn-primary" id="confirmPromote">
                    <i class="fas fa-arrow-up"></i> Promote to Admin
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Demoting Member - Unified Style -->
    <div class="unified-modal" id="demoteModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-arrow-down"></i> Demote to Member</h2>
                </div>
                <button class="unified-modal-close" onclick="closeDemoteModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box warning">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Demote <strong id="demoteMemberName"></strong> to Member?</p>
                        <p class="unified-confirm-text">They will lose the following privileges:</p>
                        <ul class="unified-feature-list">
                            <li class="muted"><i class="fas fa-times"></i> Ability to invite new members</li>
                            <li class="muted"><i class="fas fa-times"></i> Ability to approve/deny join requests</li>
                            <li class="muted"><i class="fas fa-times"></i> Admin management privileges</li>
                            <li><i class="fas fa-check"></i> Will remain as a regular team member</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" onclick="closeDemoteModal()">Cancel</button>
                <button class="unified-btn unified-btn-warning" id="confirmDemote">
                    <i class="fas fa-arrow-down"></i> Demote to Member
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Kicking Member - Unified Style -->
    <div class="unified-modal" id="kickModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-user-times"></i> Kick Member</h2>
                </div>
                <button class="unified-modal-close" onclick="closeKickModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box danger">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-triangle-exclamation"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Remove <strong id="kickMemberName"></strong> from the team?</p>
                        <p class="unified-confirm-text">
                            This will immediately remove them from the team and revoke all access.
                        </p>
                        <p class="unified-confirm-text danger mt-sm">
                            This action cannot be undone.
                        </p>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" onclick="closeKickModal()">Cancel</button>
                <button class="unified-btn unified-btn-danger" id="confirmKick">
                    <i class="fas fa-user-times"></i> Kick Member
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Approving Join Request - Unified Style -->
    <div class="unified-modal" id="approveJoinModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2>Approve Join Request</h2>
                </div>
                <button class="unified-modal-close" onclick="closeApproveJoinModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box info">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Add <strong id="approveJoinName"></strong> to your team?</p>
                        <p class="unified-confirm-text" id="approveJoinEmail"></p>
                        <p class="unified-confirm-text mt-sm">
                            They will be added as a regular team member with standard permissions.
                        </p>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" onclick="closeApproveJoinModal()">Cancel</button>
                <button class="unified-btn unified-btn-primary" id="confirmApproveJoin">
                    <i class="fas fa-check"></i> Approve
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Rejecting Join Request - Unified Style -->
    <div class="unified-modal" id="rejectJoinModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2>Reject Join Request</h2>
                </div>
                <button class="unified-modal-close" onclick="closeRejectJoinModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box warning">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-user-xmark"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Reject <strong id="rejectJoinName"></strong>'s request?</p>
                        <p class="unified-confirm-text" id="rejectJoinEmail"></p>
                        <p class="unified-confirm-text mt-sm">
                            They will not be notified and can request to join again later.
                        </p>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" onclick="closeRejectJoinModal()">Cancel</button>
                <button class="unified-btn unified-btn-danger" id="confirmRejectJoin">
                    <i class="fas fa-times"></i> Reject
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Adding Events - Unified Style -->
    <div class="unified-modal" id="eventModal">
        <div class="unified-modal-container modal-form-wide">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-calendar-plus"></i> New Event</h2>
                    <p class="subtitle">Schedule an event for your team</p>
                </div>
                <button class="unified-modal-close" id="closeEventModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="eventForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid two-col">
                        <!-- Event Title - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Event Title <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="eventTitle" required placeholder="Enter event name">
                        </div>
                        
                        <!-- Date -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                Date <span class="required">*</span>
                            </label>
                            <input type="date" class="unified-input" id="eventDate" required>
                        </div>
                        
                        <!-- Duration Display -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                Duration
                            </label>
                            <div class="unified-input duration-display" id="eventDuration">
                                <span id="durationText">0 minutes</span>
                            </div>
                        </div>
                        
                        <!-- Start Time -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                Start Time <span class="required">*</span>
                            </label>
                            <div class="time-picker-wrapper" id="startTimeWrapper">
                                <div class="time-picker-display" id="startTimeDisplay">
                                    <input type="text" id="eventHour" class="time-input-field" placeholder="09" maxlength="2" inputmode="numeric">
                                    <span class="time-separator">:</span>
                                    <input type="text" id="eventMinute" class="time-input-field" placeholder="00" maxlength="2" inputmode="numeric">
                                    <i class="fas fa-chevron-down time-picker-arrow"></i>
                                </div>
                                <div class="time-picker-dropdown" id="startTimeDropdown">
                                    <div class="time-picker-columns">
                                        <div class="time-picker-column" id="startHourColumn">
                                            <div class="time-picker-column-header">Hour</div>
                                            <div class="time-picker-options" id="startHourOptions"></div>
                                        </div>
                                        <div class="time-picker-column" id="startMinuteColumn">
                                            <div class="time-picker-column-header">Minute</div>
                                            <div class="time-picker-options" id="startMinuteOptions"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- End Time -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                End Time <span class="required">*</span>
                            </label>
                            <div class="time-picker-wrapper" id="endTimeWrapper">
                                <div class="time-picker-display" id="endTimeDisplay">
                                    <input type="text" id="eventEndHour" class="time-input-field" placeholder="17" maxlength="2" inputmode="numeric">
                                    <span class="time-separator">:</span>
                                    <input type="text" id="eventEndMinute" class="time-input-field" placeholder="00" maxlength="2" inputmode="numeric">
                                    <i class="fas fa-chevron-down time-picker-arrow"></i>
                                </div>
                                <div class="time-picker-dropdown" id="endTimeDropdown">
                                    <div class="time-picker-columns">
                                        <div class="time-picker-column" id="endHourColumn">
                                            <div class="time-picker-column-header">Hour</div>
                                            <div class="time-picker-options" id="endHourOptions"></div>
                                        </div>
                                        <div class="time-picker-column" id="endMinuteColumn">
                                            <div class="time-picker-column-header">Minute</div>
                                            <div class="time-picker-options" id="endMinuteOptions"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Color Picker - Inline -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Color
                            </label>
                            <input type="hidden" id="eventColor" value="#ef4444">
                            <div class="color-picker-inline narrow" id="eventColorPicker" style="max-width: 432px;">
                                <div class="color-picker-inner-pill">
                                    <div class="color-picker-current-swatch" id="eventColorSwatch" style="background: #ef4444;"></div>
                                    <input type="text" id="eventColorHex" value="#ef4444" maxlength="7" spellcheck="false" autocomplete="off" inputmode="text" aria-label="Hex color" style="color:#ff2d9f;background:transparent;border:0;outline:0;box-shadow:none;padding:0;margin:0;font:600 15px/1 -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', sans-serif;letter-spacing:0.4px;text-transform:uppercase;">
                                </div>
                                <div class="color-picker-recent" id="eventColorRecent">
                                    <button type="button" class="color-picker-recent-btn" data-color="#ef4444" style="background: #ef4444;"></button>
                                    <button type="button" class="color-picker-recent-btn" data-color="#f59e0b" style="background: #f59e0b;"></button>
                                    <button type="button" class="color-picker-recent-btn" data-color="#22c55e" style="background: #22c55e;"></button>
                                    <button type="button" class="color-picker-recent-btn" data-color="#14b8a6" style="background: #14b8a6;"></button>
                                    <button type="button" class="color-picker-recent-btn" data-color="#0ea5e9" style="background: #0ea5e9;"></button>
                                    <button type="button" class="color-picker-recent-btn" data-color="#6d5dfc" style="background: #6d5dfc;"></button>
                                    <button type="button" class="color-picker-recent-btn" data-color="#a855f7" style="background: #a855f7;"></button>
                                    <button type="button" class="color-picker-recent-btn" data-color="#475569" style="background: #475569;"></button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Repeat Selector -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-redo"></i> Repeat
                            </label>
                            <div class="repeat-pills">
                                <label class="repeat-pill selected" data-repeat="none">
                                    <input type="radio" name="eventRepeat" value="none" checked>
                                    <span>None</span>
                                </label>
                                <label class="repeat-pill" data-repeat="daily">
                                    <input type="radio" name="eventRepeat" value="daily">
                                    <span>Daily</span>
                                </label>
                                <label class="repeat-pill" data-repeat="weekly">
                                    <input type="radio" name="eventRepeat" value="weekly">
                                    <span>Weekly</span>
                                </label>
                                <label class="repeat-pill" data-repeat="monthly">
                                    <input type="radio" name="eventRepeat" value="monthly">
                                    <span>Monthly</span>
                                </label>
                                <label class="repeat-pill" data-repeat="yearly">
                                    <input type="radio" name="eventRepeat" value="yearly">
                                    <span>Yearly</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Visibility Selector -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-eye"></i> Visibility
                            </label>
                            <div class="calendar-view-toggle visibility-toggle" data-target="eventVisibility">
                                <input type="hidden" name="eventVisibility" value="team">
                                <button type="button" class="view-toggle-btn active" data-visibility="team">
                                    <i class="fas fa-users"></i>
                                    <span>Team</span>
                                </button>
                                <button type="button" class="view-toggle-btn" data-visibility="private">
                                    <i class="fas fa-lock"></i>
                                    <span>Private</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Description - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Description <span class="optional">(optional)</span>
                            </label>
                            <textarea class="unified-textarea" id="eventDescription" rows="2" placeholder="Add details about this event..."></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" id="cancelEventBtn">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary">
                        <i class="fas fa-check"></i> Add Event
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Event Details - Clean Modern Design -->
    <div class="unified-modal" id="eventDetailsModal">
        <div class="unified-modal-container event-details-modal">
            <div class="unified-modal-header event-modal-header-clean">
                <div class="event-header-text">
                    <h2 id="eventDetailsTitle">Event Details</h2>
                    <p class="event-subtitle" id="eventSubtitle"></p>
                </div>
                <div class="unified-modal-header-actions">
                    <button class="btn-icon-clean" id="editEventBtnHeader" style="display: none;" title="Edit Event">
                        <i class="fas fa-pen"></i>
                    </button>
                    <button type="button" class="unified-modal-close btn-close-clean" id="closeEventDetailsModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="unified-modal-body event-modal-body-clean">
                <!-- Clean info rows -->
                <div class="event-info-row-clean">
                    <i class="fas fa-calendar-day event-icon-clean"></i>
                    <div class="event-info-text">
                        <span class="event-label-clean">Date</span>
                        <span class="event-value-clean" id="detailDate"></span>
                    </div>
                </div>
                
                <div class="event-info-row-clean">
                    <i class="fas fa-clock event-icon-clean"></i>
                    <div class="event-info-text">
                        <span class="event-label-clean">Time</span>
                        <span class="event-value-clean" id="detailTime"></span>
                    </div>
                </div>
                
                <div class="event-info-row-clean">
                    <i class="fas fa-hourglass-half event-icon-clean"></i>
                    <div class="event-info-text">
                        <span class="event-label-clean">Duration</span>
                        <span class="event-value-clean" id="detailDuration"></span>
                    </div>
                </div>
                
                <div class="event-info-row-clean">
                    <i class="fas fa-user-circle event-icon-clean"></i>
                    <div class="event-info-text">
                        <span class="event-label-clean">Created By</span>
                        <span class="event-value-clean" id="detailCreatedBy"></span>
                    </div>
                </div>
                
                <!-- Visibility -->
                <div class="event-info-row-clean" id="visibilityCard" style="display: none;">
                    <i class="fas fa-eye event-icon-clean"></i>
                    <div class="event-info-text">
                        <span class="event-label-clean">Visibility</span>
                        <span class="event-value-clean visibility-badge-clean" id="detailVisibility"></span>
                    </div>
                </div>
                
                <!-- Repeat -->
                <div class="event-info-row-clean" id="repeatCard" style="display: none;">
                    <i class="fas fa-redo event-icon-clean"></i>
                    <div class="event-info-text">
                        <span class="event-label-clean">Repeats</span>
                        <span class="event-value-clean" id="detailRepeat"></span>
                    </div>
                </div>
                
                <!-- Description Section -->
                <div class="event-description-clean" id="descriptionSection">
                    <div class="event-desc-label">
                        <i class="fas fa-align-left"></i>
                        <span>Description</span>
                    </div>
                    <div class="event-desc-text" id="detailDescription">
                        No description provided
                    </div>
                </div>
                
                <!-- Hidden color field for JS use -->
                <div id="detailColor" style="display: none;"></div>
            </div>
            <div class="unified-modal-footer event-modal-footer-clean" id="eventDetailsActions">
                <button type="button" class="unified-btn unified-btn-danger btn-clean" id="deleteEventBtn" style="display: none;">
                    <i class="fas fa-trash"></i> Delete
                </button>
                <button type="button" class="unified-btn unified-btn-secondary btn-clean" onclick="closeModal('eventDetailsModal')">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- ===================================
         ADD TASK MODAL - Unified Modern Design
         Wide 2-column layout, minimal scrolling
         =================================== -->
    <div class="unified-modal" id="taskModal">
        <div class="unified-modal-container modal-form-wide">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-plus-circle"></i> New Task</h2>
                    <p class="subtitle">Add a new task to your team's workflow</p>
                </div>
                <button class="unified-modal-close" id="closeTaskModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="taskForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid two-col">
                        <!-- Task Title - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Title <span class="required">*</span>
                                <span class="optional" id="taskTitleCounter" style="margin-left: auto;">0/20 words</span>
                            </label>
                            <input type="text" class="unified-input" id="taskTitle" required placeholder="What needs to be done?">
                        </div>
                        
                        <!-- Description - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Description <span class="optional">(optional)</span>
                            </label>
                            <textarea class="unified-textarea" id="taskDescription" rows="2" placeholder="Add details or context..."></textarea>
                        </div>
                        
                        <!-- Assignee -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-user"></i> Assignee <span class="required">*</span>
                            </label>
                            <div class="unified-dropdown" id="taskAssigneeDropdown">
                                <div class="unified-dropdown-trigger" id="taskAssigneeTrigger">
                                    <div class="unified-dropdown-value">
                                        <span class="dropdown-placeholder">Select team member...</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="taskAssigneeMenu"></div>
                                <input type="hidden" id="taskAssignee" name="taskAssignee" required>
                            </div>
                        </div>
                        
                        <!-- Due Date -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-calendar"></i> Due Date
                            </label>
                            <input type="date" class="unified-input" id="taskDueDate">
                        </div>
                        
                        <!-- Priority -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-flag"></i> Priority
                            </label>
                            <div class="unified-dropdown" id="taskPriorityDropdown">
                                <div class="unified-dropdown-trigger" id="taskPriorityTrigger">
                                    <div class="unified-dropdown-value">
                                        <span class="unified-priority-dot medium"></span>
                                        <span>Medium</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="taskPriorityMenu">
                                    <div class="unified-dropdown-option" data-value="low">
                                        <span class="unified-priority-dot low"></span>
                                        <span>Low</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option selected" data-value="medium">
                                        <span class="unified-priority-dot medium"></span>
                                        <span>Medium</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="high">
                                        <span class="unified-priority-dot high"></span>
                                        <span>High</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                </div>
                                <input type="hidden" id="taskPriority" name="taskPriority" value="medium">
                            </div>
                        </div>
                        
                        <!-- Status -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-circle-dot"></i> Status
                            </label>
                            <div class="unified-dropdown" id="taskStatusDropdown">
                                <div class="unified-dropdown-trigger" id="taskStatusTrigger">
                                    <div class="unified-dropdown-value">
                                        <span class="unified-status-dot todo"></span>
                                        <span>To Do</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="taskStatusMenu">
                                    <div class="unified-dropdown-option selected" data-value="todo">
                                        <span class="unified-status-dot todo"></span>
                                        <span>To Do</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="inprogress">
                                        <span class="unified-status-dot inprogress"></span>
                                        <span>In Progress</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="done">
                                        <span class="unified-status-dot done"></span>
                                        <span>Done</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                </div>
                                <input type="hidden" id="taskStatus" name="taskStatus" value="todo">
                            </div>
                        </div>
                        
                        <!-- Budget -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-dollar-sign"></i> Budget <span class="optional">(optional)</span>
                            </label>
                            <div class="unified-input-group">
                                <span class="input-addon">$</span>
                                <input type="number" class="unified-input" id="taskBudget" placeholder="0.00" min="0" step="0.01">
                            </div>
                        </div>
                        
                        <!-- Estimated Time -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-clock"></i> Est. Time <span class="optional">(optional)</span>
                            </label>
                            <div class="unified-input-group">
                                <input type="number" class="unified-input" id="taskEstimatedTime" placeholder="0" min="0" step="0.5">
                                <span class="input-addon">hrs</span>
                            </div>
                        </div>
                        
                        <!-- Progress - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-tasks"></i> Progress
                            </label>
                            <div class="task-modal-progress-control">
                                <div class="task-modal-progress-track">
                                    <div class="task-modal-progress-fill" id="taskProgressFill" style="width: 0%;"></div>
                                    <input type="range" class="task-modal-progress-slider" id="taskProgressSlider" min="0" max="100" value="0">
                                </div>
                                <div class="task-modal-progress-badge" id="taskProgressBadge">
                                    <span id="taskProgressDisplay">0</span>%
                                </div>
                                <input type="hidden" id="taskProgress" value="0">
                            </div>
                        </div>
                        
                        <!-- Spreadsheet Selection - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-table"></i> Add to Spreadsheet
                            </label>
                            <div class="unified-dropdown" id="taskSpreadsheetDropdown">
                                <div class="unified-dropdown-trigger" id="taskSpreadsheetTrigger">
                                    <div class="unified-dropdown-value">
                                        <i class="fas fa-table" style="color: var(--accent);"></i>
                                        <span>All Tasks</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="taskSpreadsheetMenu"></div>
                                <input type="hidden" id="taskSpreadsheet" name="taskSpreadsheet" value="default">
                            </div>
                        </div>
                        
                        <!-- Show on Calendar Toggle -->
                        <div class="unified-form-field full-width">
                            <label class="inline-toggle-row">
                                <span class="inline-toggle-label"><i class="fas fa-calendar-alt"></i> Show on calendar</span>
                                <div class="mini-toggle">
                                    <input type="checkbox" id="taskShowOnCalendar" checked>
                                    <span class="mini-toggle-track"></span>
                                </div>
                            </label>
                        </div>
                        
                        <!-- RECURRING TASK: Repeat frequency selector -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-redo"></i> Repeat <span class="optional">(optional)</span>
                            </label>
                            <div class="unified-dropdown" id="taskRecurrenceDropdown">
                                <div class="unified-dropdown-trigger" id="taskRecurrenceTrigger">
                                    <div class="unified-dropdown-value">
                                        <span>Does not repeat</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="taskRecurrenceMenu">
                                    <div class="unified-dropdown-option selected" data-value="none">
                                        <span>Does not repeat</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="daily">
                                        <i class="fas fa-sun" style="margin-right: 8px; color: var(--warning);"></i>
                                        <span>Daily</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="weekly">
                                        <i class="fas fa-calendar-week" style="margin-right: 8px; color: var(--accent);"></i>
                                        <span>Weekly</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="monthly">
                                        <i class="fas fa-calendar-alt" style="margin-right: 8px; color: var(--success);"></i>
                                        <span>Monthly</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                </div>
                                <input type="hidden" id="taskRecurrence" name="taskRecurrence" value="none">
                            </div>
                            <small class="recurrence-hint" id="recurrenceHint" style="display: none; margin-top: 6px; color: var(--text-muted);">
                                <i class="fas fa-info-circle"></i> Task will reappear automatically after completion
                            </small>
                        </div>
                    </div>
                </div>
                
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" id="cancelTaskBtn">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary">
                        <i class="fas fa-check"></i> Create Task
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ===================================
         ADD LEAD MODAL - Unified Modern Design
         Wide 2-column layout for lead management
         =================================== -->
    <div class="unified-modal" id="leadModal">
        <div class="unified-modal-container modal-form-wide">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-user-plus"></i> New Lead</h2>
                    <p class="subtitle">Add a new lead to your sales pipeline</p>
                </div>
                <button class="unified-modal-close" id="closeLeadModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="leadForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid two-col">
                        <!-- Lead Name - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Lead Name <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="leadName" required placeholder="Enter lead name or company">
                        </div>
                        
                        <!-- Status -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-circle-dot"></i> Status
                            </label>
                            <div class="unified-dropdown" id="leadStatusDropdown">
                                <div class="unified-dropdown-trigger" id="leadStatusTrigger">
                                    <div class="unified-dropdown-value">
                                        <span class="unified-status-dot new"></span>
                                        <span>New</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="leadStatusMenu">
                                    <div class="unified-dropdown-option selected" data-value="New" data-color="#007AFF">
                                        <span class="unified-status-dot new"></span>
                                        <span>New</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Contacted" data-color="#5856D6">
                                        <span class="unified-status-dot contacted"></span>
                                        <span>Contacted</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Qualified" data-color="#FF9500">
                                        <span class="unified-status-dot qualified"></span>
                                        <span>Qualified</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Won" data-color="#34C759">
                                        <span class="unified-status-dot won"></span>
                                        <span>Won</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Lost" data-color="#FF3B30">
                                        <span class="unified-status-dot lost"></span>
                                        <span>Lost</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                </div>
                                <input type="hidden" id="leadStatus" name="leadStatus" value="New">
                            </div>
                        </div>
                        
                        <!-- Source -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-route"></i> Source
                            </label>
                            <div class="unified-dropdown" id="leadSourceDropdown">
                                <div class="unified-dropdown-trigger" id="leadSourceTrigger">
                                    <div class="unified-dropdown-value">
                                        <span class="unified-status-dot" style="background: #007AFF;"></span>
                                        <span>Website</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="leadSourceMenu">
                                    <div class="unified-dropdown-option selected" data-value="Website" data-color="#007AFF">
                                        <span class="unified-status-dot" style="background: #007AFF;"></span>
                                        <span>Website</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Referral" data-color="#34C759">
                                        <span class="unified-status-dot" style="background: #34C759;"></span>
                                        <span>Referral</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Ad Campaign" data-color="#FF9500">
                                        <span class="unified-status-dot" style="background: #FF9500;"></span>
                                        <span>Ad Campaign</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Social Media" data-color="#5856D6">
                                        <span class="unified-status-dot" style="background: #5856D6;"></span>
                                        <span>Social Media</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Other" data-color="#8E8E93">
                                        <span class="unified-status-dot" style="background: #8E8E93;"></span>
                                        <span>Other</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                </div>
                                <input type="hidden" id="leadSource" name="leadSource" value="Website">
                            </div>
                        </div>
                        
                        <!-- Value -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-dollar-sign"></i> Value <span class="optional">(optional)</span>
                            </label>
                            <div class="unified-input-group">
                                <span class="input-addon">$</span>
                                <input type="number" class="unified-input" id="leadValue" placeholder="0" min="0" step="1">
                            </div>
                        </div>
                        
                        <!-- Contact -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-address-book"></i> Contact
                            </label>
                            <input type="text" class="unified-input" id="leadContact" placeholder="Email or phone number">
                        </div>
                        
                        <!-- Notes - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Notes <span class="optional">(optional)</span>
                            </label>
                            <textarea class="unified-textarea" id="leadNotes" rows="2" placeholder="Add notes about this lead..."></textarea>
                        </div>
                        
                        <!-- Spreadsheet Selection - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-table"></i> Add to Spreadsheet
                            </label>
                            <div class="unified-dropdown" id="leadSpreadsheetDropdown">
                                <div class="unified-dropdown-trigger" id="leadSpreadsheetTrigger">
                                    <div class="unified-dropdown-value">
                                        <i class="fas fa-table" style="color: var(--accent);"></i>
                                        <span id="leadSpreadsheetLabel">Select spreadsheet</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="leadSpreadsheetMenu"></div>
                                <input type="hidden" id="leadSpreadsheet" name="leadSpreadsheet" value="">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" id="cancelLeadBtn">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary">
                        <i class="fas fa-check"></i> Create Lead
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Adding Teammates -->
    <div class="unified-modal" id="teammateModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-user-plus"></i> Add Team Member</h2>
                    <p class="subtitle">Invite someone to join your team</p>
                </div>
                <button class="unified-modal-close" id="closeTeammateModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="teammateForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid single-col">
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-user"></i> Full Name <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="teammateName" required placeholder="Enter teammate's name">
                        </div>
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-envelope"></i> Email Address <span class="required">*</span>
                            </label>
                            <input type="email" class="unified-input" id="teammateEmail" required placeholder="Enter teammate's email">
                            <p class="unified-form-hint">An invitation will be sent to this email</p>
                        </div>
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-briefcase"></i> Role/Occupation <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="teammateOccupation" required placeholder="e.g., Project Manager, Developer">
                        </div>
                    </div>
                </div>
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" id="cancelTeammateBtn">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary">
                        <i class="fas fa-paper-plane"></i> Send Invitation
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Join Team Modal -->
    <div class="unified-modal" id="joinTeamModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-sign-in-alt"></i> Join a Team</h2>
                    <p class="subtitle">Enter the team code to request access</p>
                </div>
                <button class="unified-modal-close" id="closeJoinTeamModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="joinTeamModalForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid single-col">
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                Team Code <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="joinTeamCodeModalInput" required placeholder="e.g., TEAM-ABC123 or ABC123" maxlength="11" style="text-transform: uppercase;">
                            <p class="unified-form-hint">Ask your team admin for the team code</p>
                        </div>
                    </div>
                </div>
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" id="cancelJoinTeamBtn">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary">
                        <i class="fas fa-arrow-right"></i>
                        Join Team
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Custom Column Modal - Unified Style -->
    <div class="unified-modal" id="customColumnModal">
        <div class="unified-modal-container">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2>Create Column</h2>
                </div>
                <button class="unified-modal-close" id="closeCustomColumnModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <!-- Column Name -->
                <div class="unified-form-grid single-col">
                    <div class="unified-form-field">
                        <label class="unified-form-label">Column Name <span class="required">*</span></label>
                        <input type="text" class="unified-input" id="customColumnName" placeholder="e.g. Status, Difficulty, Client" maxlength="30">
                        <span class="field-error" id="columnNameError"></span>
                    </div>

                    <!-- Input Type Selector -->
                    <div class="unified-form-field">
                        <label class="unified-form-label">Input Type</label>
                        <div class="calendar-view-toggle input-type-toggle" id="inputTypeSelector">
                            <button type="button" class="view-toggle-btn active" data-type="dropdown">
                                <i class="fas fa-caret-square-down"></i>
                                <span>Dropdown</span>
                            </button>
                            <button type="button" class="view-toggle-btn" data-type="slider">
                                <i class="fas fa-sliders-h"></i>
                                <span>Slider</span>
                            </button>
                            <button type="button" class="view-toggle-btn" data-type="number">
                                <i class="fas fa-hashtag"></i>
                                <span>Number</span>
                            </button>
                            <button type="button" class="view-toggle-btn" data-type="text">
                                <i class="fas fa-font"></i>
                                <span>Text</span>
                            </button>
                            <button type="button" class="view-toggle-btn" data-type="link">
                                <i class="fas fa-link"></i>
                                <span>Link</span>
                            </button>
                        </div>
                    </div>

                    <!-- Dropdown Options (only visible when type = dropdown) -->
                    <div class="unified-form-field dropdown-options-group" id="dropdownOptionsGroup">
                        <label class="unified-form-label">Dropdown Options</label>
                        <div class="dropdown-options-list" id="dropdownOptionsList">
                            <div class="dropdown-option-item">
                                <input type="text" class="unified-input dropdown-option-input" placeholder="Option 1" maxlength="25">
                                <div class="option-color-picker">
                                    <button type="button" class="color-swatch active" data-color="#9CA3AF" style="background: #9CA3AF" title="Grey"></button>
                                    <button type="button" class="color-swatch" data-color="#3B82F6" style="background: #3B82F6" title="Blue"></button>
                                    <button type="button" class="color-swatch" data-color="#22C55E" style="background: #22C55E" title="Green"></button>
                                    <button type="button" class="color-swatch" data-color="#EAB308" style="background: #EAB308" title="Yellow"></button>
                                    <button type="button" class="color-swatch" data-color="#F97316" style="background: #F97316" title="Orange"></button>
                                    <button type="button" class="color-swatch" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                                    <button type="button" class="color-swatch" data-color="#A855F7" style="background: #A855F7" title="Purple"></button>
                                </div>
                                <button type="button" class="remove-option-btn" title="Remove">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="dropdown-option-item">
                                <input type="text" class="unified-input dropdown-option-input" placeholder="Option 2" maxlength="25">
                                <div class="option-color-picker">
                                    <button type="button" class="color-swatch active" data-color="#9CA3AF" style="background: #9CA3AF" title="Grey"></button>
                                    <button type="button" class="color-swatch" data-color="#3B82F6" style="background: #3B82F6" title="Blue"></button>
                                    <button type="button" class="color-swatch" data-color="#22C55E" style="background: #22C55E" title="Green"></button>
                                    <button type="button" class="color-swatch" data-color="#EAB308" style="background: #EAB308" title="Yellow"></button>
                                    <button type="button" class="color-swatch" data-color="#F97316" style="background: #F97316" title="Orange"></button>
                                    <button type="button" class="color-swatch" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                                    <button type="button" class="color-swatch" data-color="#A855F7" style="background: #A855F7" title="Purple"></button>
                                </div>
                                <button type="button" class="remove-option-btn" title="Remove">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <button type="button" class="unified-btn unified-btn-secondary" id="addDropdownOption" style="margin-top: 8px;">
                            <i class="fas fa-plus"></i> Option
                        </button>
                    </div>

                    <!-- Slider Config (only visible when type = slider) -->
                    <div class="unified-form-field slider-config-group" id="sliderConfigGroup" style="display: none;">
                        <label class="unified-form-label">Slider Range</label>
                        <div class="slider-range-inputs">
                            <div class="range-input">
                                <span>Min</span>
                                <input type="number" class="unified-input" id="sliderMin" value="0" min="0" max="999">
                            </div>
                            <div class="range-input">
                                <span>Max</span>
                                <input type="number" class="unified-input" id="sliderMax" value="100" min="1" max="1000">
                            </div>
                        </div>
                        
                        <label class="unified-form-label" style="margin-top: 16px;">Gradient</label>
                        <label class="toggle-switch" style="margin: 0 8px 0 0; vertical-align: middle;">
                            <input type="checkbox" id="sliderGradientToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        Use gradient between ranges
                        
                        <!-- Slider Color Ranges -->
                        <label class="unified-form-label" style="margin-top: 16px;">Color Ranges</label>
                        <div class="slider-color-ranges" id="sliderColorRanges">
                            <div class="color-range-item">
                                <input type="number" class="unified-input range-min-input" value="0" min="0" placeholder="Min">
                                <span class="range-separator">‚Äì</span>
                                <input type="number" class="unified-input range-max-input" value="33" placeholder="Max">
                                <div class="range-color-picker">
                                    <button type="button" class="color-swatch active" data-color="#9CA3AF" style="background: #9CA3AF" title="Grey"></button>
                                    <button type="button" class="color-swatch" data-color="#3B82F6" style="background: #3B82F6" title="Blue"></button>
                                    <button type="button" class="color-swatch" data-color="#22C55E" style="background: #22C55E" title="Green"></button>
                                    <button type="button" class="color-swatch" data-color="#EAB308" style="background: #EAB308" title="Yellow"></button>
                                    <button type="button" class="color-swatch" data-color="#F97316" style="background: #F97316" title="Orange"></button>
                                    <button type="button" class="color-swatch" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                                    <button type="button" class="color-swatch" data-color="#A855F7" style="background: #A855F7" title="Purple"></button>
                                </div>
                                <button type="button" class="remove-range-btn" title="Remove range">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="color-range-item">
                                <input type="number" class="unified-input range-min-input" value="34" min="0" placeholder="Min">
                                <span class="range-separator">‚Äì</span>
                                <input type="number" class="unified-input range-max-input" value="66" placeholder="Max">
                                <div class="range-color-picker">
                                    <button type="button" class="color-swatch" data-color="#9CA3AF" style="background: #9CA3AF" title="Grey"></button>
                                    <button type="button" class="color-swatch" data-color="#3B82F6" style="background: #3B82F6" title="Blue"></button>
                                    <button type="button" class="color-swatch" data-color="#22C55E" style="background: #22C55E" title="Green"></button>
                                    <button type="button" class="color-swatch active" data-color="#EAB308" style="background: #EAB308" title="Yellow"></button>
                                    <button type="button" class="color-swatch" data-color="#F97316" style="background: #F97316" title="Orange"></button>
                                    <button type="button" class="color-swatch" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                                    <button type="button" class="color-swatch" data-color="#A855F7" style="background: #A855F7" title="Purple"></button>
                                </div>
                                <button type="button" class="remove-range-btn" title="Remove range">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="color-range-item">
                                <input type="number" class="unified-input range-min-input" value="67" min="0" placeholder="Min">
                                <span class="range-separator">‚Äì</span>
                                <input type="number" class="unified-input range-max-input" value="100" placeholder="Max">
                                <div class="range-color-picker">
                                    <button type="button" class="color-swatch" data-color="#9CA3AF" style="background: #9CA3AF" title="Grey"></button>
                                    <button type="button" class="color-swatch" data-color="#3B82F6" style="background: #3B82F6" title="Blue"></button>
                                    <button type="button" class="color-swatch active" data-color="#22C55E" style="background: #22C55E" title="Green"></button>
                                    <button type="button" class="color-swatch" data-color="#EAB308" style="background: #EAB308" title="Yellow"></button>
                                    <button type="button" class="color-swatch" data-color="#F97316" style="background: #F97316" title="Orange"></button>
                                    <button type="button" class="color-swatch" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                                    <button type="button" class="color-swatch" data-color="#A855F7" style="background: #A855F7" title="Purple"></button>
                                </div>
                                <button type="button" class="remove-range-btn" title="Remove range">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <button type="button" class="unified-btn unified-btn-secondary" id="addColorRange" style="margin-top: 8px;">
                            <i class="fas fa-plus"></i> Range
                        </button>
                    </div>

                    <!-- Icon Selector -->
                    <div class="unified-form-field">
                        <label class="unified-form-label">Column Icon</label>
                        <div class="icon-picker-inline narrow" id="iconPicker">
                            <div class="icon-picker-inner-pill">
                                <span class="icon-picker-selected" id="columnIconSelected"><i class="fas fa-tag"></i></span>
                            </div>
                            <div class="icon-picker-options">
                                <button type="button" class="icon-picker-option selected" data-icon="fa-tag" title="Tag">
                                    <i class="fas fa-tag"></i>
                                </button>
                                <button type="button" class="icon-picker-option" data-icon="fa-flag" title="Flag">
                                    <i class="fas fa-flag"></i>
                                </button>
                                <button type="button" class="icon-picker-option" data-icon="fa-star" title="Star">
                                    <i class="fas fa-star"></i>
                                </button>
                                <button type="button" class="icon-picker-option" data-icon="fa-check-circle" title="Check">
                                    <i class="fas fa-check-circle"></i>
                                </button>
                                <button type="button" class="icon-picker-option" data-icon="fa-clock" title="Clock">
                                    <i class="fas fa-clock"></i>
                                </button>
                                <button type="button" class="icon-picker-option" data-icon="fa-bolt" title="Bolt">
                                    <i class="fas fa-bolt"></i>
                                </button>
                                <button type="button" class="icon-picker-option" data-icon="fa-fire" title="Fire">
                                    <i class="fas fa-fire"></i>
                                </button>
                                <button type="button" class="icon-picker-option" data-icon="fa-heart" title="Heart">
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                        </div>
                        <input type="hidden" id="columnIcon" value="fa-tag">
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer" style="justify-content: space-between;">
                <button type="button" class="unified-btn unified-btn-danger" id="deleteColumnBtn" style="display: none;">
                    <i class="fas fa-trash"></i> Delete Column
                </button>
                <div class="modal-footer-right" style="display: flex; gap: 8px; margin-left: auto;">
                    <button type="button" class="unified-btn unified-btn-secondary" id="cancelCustomColumn">Cancel</button>
                    <button type="button" class="unified-btn unified-btn-primary" id="createCustomColumn">
                        <i class="fas fa-plus"></i> Create Column
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Link Lobby: Add/Edit Group Modal - Unified Style -->
    <div class="unified-modal" id="linkGroupModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2 id="linkGroupModalTitle"><i class="fas fa-folder-plus"></i> Create Group</h2>
                    <p class="subtitle">Organize your links into groups</p>
                </div>
                <button class="unified-modal-close" onclick="closeLinkGroupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="linkGroupForm" onsubmit="saveLinkGroup(event)">
                <div class="unified-modal-body">
                    <input type="hidden" id="linkGroupId" value="">
                    <div class="unified-form-grid single-col">
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                Group Name <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="linkGroupName" placeholder="e.g. Design Resources, Documentation" required maxlength="50">
                        </div>
                        <div class="unified-form-field">
                            <label class="unified-checkbox-label">
                                <input type="checkbox" id="linkGroupAutoDomain">
                                <div class="unified-checkbox-content">
                                    <span class="unified-checkbox-title">Auto-group links by domain</span>
                                    <span class="unified-checkbox-desc">Links will be automatically organized into subgroups by website domain</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" onclick="closeLinkGroupModal()">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary" id="linkGroupSubmitBtn">
                        <i class="fas fa-plus"></i> Create Group
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Link Lobby: Add/Edit Link Modal - Unified Style -->
    <div class="unified-modal" id="linkModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2 id="linkModalTitle"><i class="fas fa-link"></i> Add Link</h2>
                    <p class="subtitle">Save a link to your group</p>
                </div>
                <button class="unified-modal-close" onclick="closeLinkModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="linkForm" onsubmit="saveLink(event)">
                <div class="unified-modal-body">
                    <input type="hidden" id="linkId" value="">
                    <input type="hidden" id="linkGroupIdForLink" value="">
                    <input type="hidden" id="linkDomainGroupId" value="">
                    <div class="unified-form-grid single-col">
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-globe"></i> URL <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="linkUrl" placeholder="https://example.com" required>
                        </div>
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-tag"></i> Label <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="linkLabel" placeholder="e.g. Design System Docs" required maxlength="100">
                        </div>
                        <div class="link-preview" id="linkPreview" style="display: none; padding: 12px; background: var(--bg-surface); border-radius: 10px; display: flex; align-items: center; gap: 10px;">
                            <img id="linkFaviconPreview" src="" alt="" class="link-favicon-preview" style="width: 20px; height: 20px; border-radius: 4px;">
                            <span id="linkDomainPreview" style="font-size: 13px; color: var(--text-muted);"></span>
                        </div>
                    </div>
                </div>
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" onclick="closeLinkModal()">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary" id="linkSubmitBtn">
                        <i class="fas fa-plus"></i> Add Link
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Link Lobby: Delete Confirmation Modal - Unified Style -->
    <div class="unified-modal" id="deleteLinkGroupModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-exclamation-triangle"></i> Delete Group</h2>
                </div>
                <button class="unified-modal-close" onclick="closeDeleteLinkGroupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box danger">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-trash"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Delete "<strong id="deleteGroupName"></strong>"?</p>
                        <p class="unified-confirm-text">This will also delete all links within this group. This action cannot be undone.</p>
                    </div>
                </div>
                <input type="hidden" id="deleteGroupId" value="">
            </div>
            <div class="unified-modal-footer">
                <button type="button" class="unified-btn unified-btn-secondary" onclick="closeDeleteLinkGroupModal()">Cancel</button>
                <button type="button" class="unified-btn unified-btn-danger" onclick="confirmDeleteLinkGroup()">
                    <i class="fas fa-trash"></i> Delete Group
                </button>
            </div>
        </div>
    </div>

    <!-- Doc Context Menu -->
    <div class="spreadsheet-context-menu doc-context-menu" id="docContextMenu">
        <div class="context-menu-item" id="docContextMenuOpen">
            <i class="fas fa-external-link-alt"></i>
            <span>Open</span>
        </div>
        <div class="context-menu-item" id="docContextMenuRename">
            <i class="fas fa-pen"></i>
            <span>Rename</span>
        </div>
        <div class="context-menu-item" id="docContextMenuPin">
            <i class="fas fa-thumbtack"></i>
            <span>Pin</span>
        </div>
        <div class="context-menu-item" id="docContextMenuMoveToProject">
            <i class="fas fa-folder-open"></i>
            <span>Move to Project</span>
        </div>
        <div class="context-menu-item" id="docContextMenuPrivacy">
            <i class="fas fa-eye"></i>
            <span>Visibility</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item danger" id="docContextMenuDelete">
            <i class="fas fa-trash"></i>
            <span>Delete</span>
        </div>
    </div>

    <!-- Spreadsheet Context Menu (Right-click) -->
    <div class="spreadsheet-context-menu" id="spreadsheetContextMenu">
        <div class="context-menu-item" id="contextMenuOpen">
            <i class="fas fa-external-link-alt"></i>
            <span>Open</span>
        </div>
        <div class="context-menu-item" id="contextMenuRename">
            <i class="fas fa-pen"></i>
            <span>Rename</span>
        </div>
        <div class="context-menu-item" id="contextMenuEdit">
            <i class="fas fa-palette"></i>
            <span>Edit Style & Privacy</span>
        </div>
        <div class="context-menu-item" id="contextMenuMoveToProject">
            <i class="fas fa-folder-open"></i>
            <span>Move to Project</span>
        </div>
        <div class="context-menu-item" id="contextMenuPin">
            <i class="fas fa-thumbtack"></i>
            <span>Pin</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item danger" id="contextMenuDelete">
            <i class="fas fa-trash"></i>
            <span>Delete</span>
        </div>
    </div>

    <!-- Reference Picker Modal (for Task/Sheet references) -->
    <div class="unified-modal" id="referencePickerModal" style="display: none;">
        <div class="unified-modal-container modal-form">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2 id="referencePickerTitle"><i class="fas fa-link\"></i> Insert Reference</h2>
                    <p class="subtitle" id="referencePickerSubtitle">Select an item to reference</p>
                </div>
                <button class="unified-modal-close" onclick="closeReferencePickerModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="reference-picker-search">
                    <i class="fas fa-search"></i>
                    <input type="text" id="referencePickerSearch" placeholder="Search..." autocomplete="off">
                </div>
                <div class="reference-picker-list" id="referencePickerList">
                    <!-- Items will be rendered here -->\n                </div>
            </div>
        </div>
    </div>

    <!-- Task Conversion Modal -->
    <!-- Doc Visibility Modal -->
    <div class="unified-modal" id="docVisibilityModal" style="display: none;">
        <div class="visibility-modal-content">
            <button class="visibility-modal-close" onclick="closeDocVisibilityModal()">
                <i class="fas fa-times"></i>
            </button>
            <h3 class="visibility-modal-title">Visibility</h3>
            <p class="visibility-modal-subtitle" id="docVisibilitySubtitle">Who can see this document</p>
            <div class="calendar-view-toggle visibility-toggle" data-target="docVisibility">
                <input type="hidden" name="docVisibility" value="team">
                <button type="button" class="view-toggle-btn active" data-visibility="team">
                    <i class="fas fa-users"></i>
                    <span>Team</span>
                </button>
                <button type="button" class="view-toggle-btn" data-visibility="private">
                    <i class="fas fa-lock"></i>
                    <span>Private</span>
                </button>
            </div>
            <!-- Read-Only Toggle (owner only) -->
            <div class="doc-readonly-section" id="docReadOnlySection" style="display: none;">
                <div class="doc-readonly-divider"></div>
                <label class="doc-readonly-label">
                    <div class="doc-readonly-info">
                        <div class="doc-readonly-text">
                            <i class="fas fa-eye"></i> Read-only for others
                        </div>
                        <div class="doc-readonly-desc">Only you can edit</div>
                    </div>
                    <div class="pill-toggle">
                        <input type="checkbox" id="docReadOnlyToggle">
                        <span class="pill-toggle-slider"></span>
                    </div>
                </label>
            </div>
            <div class="visibility-modal-actions">
                <button class="btn-secondary" onclick="closeDocVisibilityModal()">Cancel</button>
                <button class="btn-primary" id="saveDocVisibility">Save</button>
            </div>
        </div>
    </div>

    <!-- Transaction Modal for Finances -->
    <div class="unified-modal" id="transactionModal">
        <div class="unified-modal-container modal-form">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2 id="transactionModalTitle"><i class="fas fa-plus-circle"></i> New Transaction</h2>
                    <p class="subtitle" id="transactionModalSubtitle">Record a financial transaction</p>
                </div>
                <button class="unified-modal-close" id="closeTransactionModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="transactionForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid">
                        <!-- Transaction Type -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Type <span class="required">*</span>
                            </label>
                            <div class="transaction-type-toggle">
                                <button type="button" class="type-btn active" data-type="income">
                                    <i class="fas fa-arrow-up"></i> Income
                                </button>
                                <button type="button" class="type-btn" data-type="expense">
                                    <i class="fas fa-arrow-down"></i> Expense
                                </button>
                            </div>
                            <input type="hidden" id="transactionType" name="transactionType" value="income">
                        </div>

                        <!-- Amount -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                Amount <span class="required">*</span>
                            </label>
                            <div class="amount-input-wrapper">
                                <input type="number" class="unified-input amount-input" id="transactionAmount" 
                                       required min="0.01" step="0.01" placeholder="$0.00">
                            </div>
                        </div>

                        <!-- Date -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-calendar"></i> Date <span class="required">*</span>
                            </label>
                            <input type="date" class="unified-input" id="transactionDate" required>
                        </div>

                        <!-- Description -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Description <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="transactionDescription" 
                                   required placeholder="e.g., Client payment, Office supplies">
                        </div>

                        <!-- Category -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-tag"></i> Category
                            </label>
                            <!-- Income Categories Dropdown -->
                            <div class="transaction-category-dropdown" id="transactionCategoryIncomeContainer" style="display: block;">
                                <div class="custom-dropdown-trigger" id="transactionCategoryIncomeTrigger">
                                    <div class="dropdown-trigger-content">
                                        <span id="transactionCategoryIncomeDisplay" class="dropdown-placeholder">Select category...</span>
                                    </div>
                                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                                </div>
                                <div class="custom-dropdown-menu" id="transactionCategoryIncomeMenu">
                                    <div class="dropdown-menu-option" data-value="">Select category...</div>
                                    <div class="dropdown-menu-option" data-value="sales">Sales</div>
                                    <div class="dropdown-menu-option" data-value="services">Services</div>
                                    <div class="dropdown-menu-option" data-value="subscriptions">Subscriptions</div>
                                    <div class="dropdown-menu-option" data-value="consulting">Consulting</div>
                                    <div class="dropdown-menu-option" data-value="other-income">Other Income</div>
                                </div>
                                <input type="hidden" id="transactionCategoryIncome" value="">
                            </div>
                            
                            <!-- Expense Categories Dropdown -->
                            <div class="transaction-category-dropdown" id="transactionCategoryExpenseContainer" style="display: none;">
                                <div class="custom-dropdown-trigger" id="transactionCategoryExpenseTrigger">
                                    <div class="dropdown-trigger-content">
                                        <span id="transactionCategoryExpenseDisplay" class="dropdown-placeholder">Select category...</span>
                                    </div>
                                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                                </div>
                                <div class="custom-dropdown-menu" id="transactionCategoryExpenseMenu">
                                    <div class="dropdown-menu-option" data-value="">Select category...</div>
                                    <div class="dropdown-menu-option" data-value="payroll">Payroll</div>
                                    <div class="dropdown-menu-option" data-value="software">Software & Tools</div>
                                    <div class="dropdown-menu-option" data-value="marketing">Marketing</div>
                                    <div class="dropdown-menu-option" data-value="office">Office & Equipment</div>
                                    <div class="dropdown-menu-option" data-value="travel">Travel</div>
                                    <div class="dropdown-menu-option" data-value="utilities">Utilities</div>
                                    <div class="dropdown-menu-option" data-value="other-expense">Other Expense</div>
                                </div>
                                <input type="hidden" id="transactionCategoryExpense" value="">
                            </div>
                        </div>

                        <!-- Customer/Vendor (Optional) -->
                        <div class="unified-form-field">
                            <label class="unified-form-label" id="transactionPartyLabel">
                                <i class="fas fa-user"></i> Customer
                            </label>
                            <input type="text" class="unified-input" id="transactionParty" 
                                   placeholder="Customer or vendor name" list="customerSuggestions" autocomplete="off">
                            <datalist id="customerSuggestions"></datalist>
                        </div>

                        <!-- Recurring Toggle -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-sync-alt"></i> Recurring
                            </label>
                            <div class="toggle-switch-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" name="transactionRecurring" id="transactionRecurring">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">This is a recurring transaction (counts toward MRR)</span>
                            </div>
                        </div>

                        <!-- Recurring Frequency (shown when recurring is checked) -->
                        <div class="unified-form-field" id="recurringFrequencyField" style="display: none;">
                            <label class="unified-form-label">
                                <i class="fas fa-clock"></i> Frequency
                            </label>
                            <select class="unified-input" id="transactionFrequency">
                                <option value="monthly">Monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>

                        <!-- Notes -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Notes <span class="optional">(optional)</span>
                            </label>
                            <textarea class="unified-textarea" id="transactionNotes" rows="2" 
                                      placeholder="Additional notes or details..."></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="unified-modal-footer">
                    <button type="button" class="btn-secondary" id="cancelTransactionBtn">Cancel</button>
                    <button type="submit" class="btn-primary" id="saveTransactionBtn">
                        <i class="fas fa-save"></i> Save Transaction
                    </button>
                </div>
                <input type="hidden" id="transactionId" value="">
            </form>
        </div>
    </div>

    <!-- Delete Transaction Confirmation Modal -->
    <div class="unified-modal" id="deleteTransactionModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-trash-alt"></i> Delete Transaction</h2>
                </div>
                <button class="unified-modal-close" id="closeDeleteTransactionModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box warning">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <p>Are you sure you want to delete this transaction? This action cannot be undone.</p>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button type="button" class="btn-secondary" id="cancelDeleteTransaction">Cancel</button>
                <button type="button" class="btn-danger" id="confirmDeleteTransaction">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
            <input type="hidden" id="deleteTransactionId" value="">
        </div>
    </div>

    <!-- Customer Modal -->
    <div class="unified-modal" id="customerModal">
        <div class="unified-modal-container modal-form">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2 id="customerModalTitle"><i class="fas fa-user-plus"></i> New Customer</h2>
                    <p class="subtitle" id="customerModalSubtitle">Add a new customer to your registry</p>
                </div>
                <button class="unified-modal-close" id="closeCustomerModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="customerForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid">
                        <!-- Customer Name -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Name <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="customerName" 
                                   required placeholder="e.g., Acme Corp, John Doe" maxlength="200">
                        </div>

                        <!-- Company -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-building"></i> Company
                            </label>
                            <input type="text" class="unified-input" id="customerCompany" 
                                   placeholder="Company name" maxlength="200">
                        </div>

                        <!-- Email -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-envelope"></i> Email
                            </label>
                            <input type="email" class="unified-input" id="customerEmail" 
                                   placeholder="customer@example.com" maxlength="300">
                        </div>

                        <!-- Phone -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-phone"></i> Phone
                            </label>
                            <input type="tel" class="unified-input" id="customerPhone" 
                                   placeholder="+1 (555) 000-0000" maxlength="50">
                        </div>

                        <!-- Source (read-only, shown only for auto-created) -->
                        <div class="unified-form-field" id="customerSourceField" style="display: none;">
                            <label class="unified-form-label">
                                <i class="fas fa-info-circle"></i> Source
                            </label>
                            <input type="text" class="unified-input" id="customerSourceDisplay" readonly>
                        </div>

                        <!-- Notes -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Notes <span class="optional">(optional)</span>
                            </label>
                            <textarea class="unified-textarea" id="customerNotes" rows="2" 
                                      placeholder="Additional notes about this customer..." maxlength="1000"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="unified-modal-footer">
                    <button type="button" class="btn-secondary" id="cancelCustomerBtn">Cancel</button>
                    <button type="submit" class="btn-primary" id="saveCustomerBtn">
                        <i class="fas fa-save"></i> Save Customer
                    </button>
                </div>
                <input type="hidden" id="customerId" value="">
            </form>
        </div>
    </div>

    <!-- Delete Customer Confirmation Modal -->
    <div class="unified-modal" id="deleteCustomerModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-trash-alt"></i> Delete Customer</h2>
                </div>
                <button class="unified-modal-close" id="closeDeleteCustomerModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box warning">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <p>Are you sure you want to delete this customer? This will not delete any associated transactions.</p>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button type="button" class="btn-secondary" id="cancelDeleteCustomer">Cancel</button>
                <button type="button" class="btn-danger" id="confirmDeleteCustomer">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
            <input type="hidden" id="deleteCustomerId" value="">
        </div>
    </div>

    <!-- Subscription Modal -->
    <div class="unified-modal" id="subscriptionModal">
        <div class="unified-modal-container modal-form">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2 id="subscriptionModalTitle"><i class="fas fa-calendar-check"></i> New Subscription</h2>
                    <p class="subtitle" id="subscriptionModalSubtitle">Track a recurring subscription</p>
                </div>
                <button class="unified-modal-close" id="closeSubscriptionModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="subscriptionForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid">
                        <!-- Subscription Type (Company/Private) -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Type <span class="required">*</span>
                            </label>
                            <div class="subscription-type-toggle">
                                <button type="button" class="type-btn active" data-type="company">
                                    <i class="fas fa-building"></i> Company
                                </button>
                                <button type="button" class="type-btn" data-type="private">
                                    <i class="fas fa-user-secret"></i> Private
                                </button>
                            </div>
                            <p class="form-field-hint" id="subscriptionTypeHint">Company subscriptions appear in expenses</p>
                            <input type="hidden" id="subscriptionType" name="subscriptionType" value="company">
                        </div>

                        <!-- Service/Recipient Name -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-tag"></i> Service Name <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="subscriptionName" 
                                   required placeholder="e.g., Netflix, Spotify, GitHub, Adobe">
                        </div>

                        <!-- Amount -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                Amount <span class="required">*</span>
                            </label>
                            <div class="amount-input-wrapper">
                                <input type="number" class="unified-input amount-input" id="subscriptionAmount" 
                                       required min="0.01" step="10" placeholder="$0.00">
                            </div>
                        </div>

                        <!-- Currency -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-coins"></i> Currency
                            </label>
                            <div class="unified-dropdown" id="subscriptionCurrencyDropdown">
                                <div class="unified-dropdown-trigger" id="subscriptionCurrencyTrigger">
                                    <div class="unified-dropdown-value">
                                        <span id="subscriptionCurrencyLabel">USD ($)</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="subscriptionCurrencyMenu">
                                    <div class="unified-dropdown-option selected" data-value="USD">USD ($)</div>
                                    <div class="unified-dropdown-option" data-value="EUR">EUR (‚Ç¨)</div>
                                    <div class="unified-dropdown-option" data-value="GBP">GBP (¬£)</div>
                                    <div class="unified-dropdown-option" data-value="CAD">CAD ($)</div>
                                    <div class="unified-dropdown-option" data-value="AUD">AUD ($)</div>
                                    <div class="unified-dropdown-option" data-value="JPY">JPY (¬•)</div>
                                    <div class="unified-dropdown-option" data-value="ILS">ILS (‚Ç™)</div>
                                </div>
                                <input type="hidden" id="subscriptionCurrency" name="subscriptionCurrency" value="USD">
                            </div>
                        </div>

                        <!-- Frequency -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-redo"></i> Billing Cycle <span class="required">*</span>
                            </label>
                            <div class="unified-dropdown" id="subscriptionFrequencyDropdown">
                                <div class="unified-dropdown-trigger" id="subscriptionFrequencyTrigger">
                                    <div class="unified-dropdown-value">
                                        <span id="subscriptionFrequencyLabel">Monthly</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="subscriptionFrequencyMenu">
                                    <div class="unified-dropdown-option" data-value="weekly">Weekly</div>
                                    <div class="unified-dropdown-option selected" data-value="monthly">Monthly</div>
                                    <div class="unified-dropdown-option" data-value="quarterly">Quarterly</div>
                                    <div class="unified-dropdown-option" data-value="yearly">Yearly</div>
                                </div>
                                <input type="hidden" id="subscriptionFrequency" name="subscriptionFrequency" value="monthly">
                            </div>
                        </div>

                        <!-- Next Payment Date -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-calendar-day"></i> Next Payment <span class="required">*</span>
                            </label>
                            <input type="date" class="unified-input" id="subscriptionNextPayDate" required>
                        </div>

                        <!-- Category -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-folder"></i> Category
                            </label>
                            <div class="unified-dropdown" id="subscriptionCategoryDropdown">
                                <div class="unified-dropdown-trigger" id="subscriptionCategoryTrigger">
                                    <div class="unified-dropdown-value">
                                        <span id="subscriptionCategoryLabel">Select category...</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="subscriptionCategoryMenu">
                                    <div class="unified-dropdown-option selected" data-value="">Select category...</div>
                                    <div class="unified-dropdown-option" data-value="software">Software & Tools</div>
                                    <div class="unified-dropdown-option" data-value="streaming">Streaming & Entertainment</div>
                                    <div class="unified-dropdown-option" data-value="cloud">Cloud Services</div>
                                    <div class="unified-dropdown-option" data-value="productivity">Productivity</div>
                                    <div class="unified-dropdown-option" data-value="communication">Communication</div>
                                    <div class="unified-dropdown-option" data-value="design">Design & Creative</div>
                                    <div class="unified-dropdown-option" data-value="marketing">Marketing</div>
                                    <div class="unified-dropdown-option" data-value="storage">Storage & Backup</div>
                                    <div class="unified-dropdown-option" data-value="security">Security</div>
                                    <div class="unified-dropdown-option" data-value="other">Other</div>
                                </div>
                                <input type="hidden" id="subscriptionCategory" name="subscriptionCategory" value="">
                            </div>
                        </div>

                        <!-- Cancellation Link (Optional) -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-link"></i> Cancellation Link
                            </label>
                            <input type="url" class="unified-input" id="subscriptionCancelLink" 
                                   placeholder="https://service.com/cancel">
                            <p class="form-field-hint">Quick access to cancel or manage subscription</p>
                        </div>

                        <!-- Notes -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-sticky-note"></i> Notes
                            </label>
                            <textarea class="unified-input unified-textarea" id="subscriptionNotes" 
                                      rows="2" placeholder="Any additional notes..."></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="unified-modal-footer">
                    <button type="button" class="btn-secondary" id="cancelSubscriptionBtn">Cancel</button>
                    <button type="submit" class="btn-primary" id="saveSubscriptionBtn">
                        <i class="fas fa-save"></i> Save Subscription
                    </button>
                </div>
                <input type="hidden" id="subscriptionId" value="">
            </form>
        </div>
    </div>

    <!-- Delete Subscription Confirmation Modal -->
    <div class="unified-modal" id="deleteSubscriptionModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-trash-alt"></i> Delete Subscription</h2>
                </div>
                <button class="unified-modal-close" id="closeDeleteSubscriptionModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box warning">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <p>Are you sure you want to delete this subscription? This action cannot be undone.</p>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button type="button" class="btn-secondary" id="cancelDeleteSubscription">Cancel</button>
                <button type="button" class="btn-danger" id="confirmDeleteSubscription">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
            <input type="hidden" id="deleteSubscriptionId" value="">
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer"></div>

    <!-- Main JavaScript -->
    <script src="loader.js"></script>
    <script src="calendar-drag.js"></script>
    <script src="main.js?v=65" id="main-script"></script>
    <script>
        // Auto-update version on links
        if (window.APP_VERSION) {
            document.getElementById('styles-link').href = `styles.css?v=${window.APP_VERSION}`;
            document.getElementById('main-script').src = `main.js?v=${window.APP_VERSION}`;
        }
    </script>
</body>
</html>