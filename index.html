<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teamster - Internal Collaboration Platform</title>
    <link rel="stylesheet" href="styles.css?v=17">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Main App Container -->
    <div class="app-container">
        
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-users"></i>
                    <span>Teamster</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <button class="nav-item active" data-section="activity">
                    <i class="fas fa-th-large"></i>
                    <span>Overview</span>
                </button>
                <button class="nav-item" data-section="team">
                    <i class="fas fa-users"></i>
                    <span>Team</span>
                </button>
                <button class="nav-item" data-section="chat">
                    <i class="fas fa-comments"></i>
                    <span>Chat</span>
                    <span class="notification-badge" id="chatNotificationBadge" style="display: none;">0</span>
                </button>
                <button class="nav-item" data-section="calendar">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Calendar</span>
                </button>
                <button class="nav-item" data-section="tasks">
                    <i class="fas fa-table-list"></i>
                    <span>Sheets</span>
                </button>
                <button class="nav-item hidden" data-section="metrics" id="metricsNavItem" style="display: none;">
                    <i class="fas fa-chart-line"></i>
                    <span>Metrics</span>
                </button>
                <button class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </button>
            </nav>
            
            <!-- Quick Add Button -->
            <div style="padding: 15px; border-bottom: 1px solid var(--border-subtle); display: none;">
                <button class="btn-add-quick btn-primary" style="width: 100%;">
                    <i class="fas fa-plus"></i> Quick Add
                </button>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-profile" id="userProfileCard" onclick="openSettings()" style="cursor: pointer;" title="Click to edit profile">
                    <div class="user-avatar" id="sidebarAvatar"></div>
                    <div class="user-info">
                        <div class="user-name" id="sidebarUserName">Loading...</div>
                        <div class="user-status">
                            <span class="status-indicator online"></span>
                            <span>Available</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="search-wrapper">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search messages, tasks, events..." id="globalSearchInput">
                        <button class="search-clear" id="searchClear" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="search-results" id="searchResults" style="display: none;"></div>
                </div>
                <div class="top-bar-actions">
                    <div style="position: relative;">
                        <button class="icon-btn" id="notificationsBtn">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                        </button>
                        <div class="notifications-dropdown" id="notificationsDropdown" style="display: none;">
                            <div class="notifications-header">
                                <h3>Notifications</h3>
                                <button class="mark-read-btn" id="markAllReadBtn" onclick="markAllNotificationsRead()">Mark all read</button>
                            </div>
                            <div class="notifications-list" id="notificationsList">
                                <div class="no-notifications">No new notifications</div>
                            </div>
                        </div>
                    </div>
                    <div style="position: relative;">
                        <button class="icon-btn" id="topBarSettingsBtn">
                            <i class="fas fa-cog"></i>
                        </button>
                        <div class="settings-dropdown" id="settingsDropdown" style="display: none;">
                            <div class="dropdown-item" onclick="openSettings()">
                                <i class="fas fa-user-circle"></i>
                                <span>My Account</span>
                            </div>
                            <div class="dropdown-item" onclick="signOutUser()">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Sign Out</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Overview/Dashboard Section -->
            <section class="content-section active" id="activity-section">
                <div class="section-header">
                    <h1>Overview</h1>
                    <p class="section-subtitle">Your tasks, events, and team activity at a glance</p>
                </div>
                
                <!-- Quick Stats Cards -->
                <div class="overview-stats">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--accent);">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="myTasksCount">0</div>
                            <div class="stat-label">My Tasks</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--warning);">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="upcomingEventsCount">0</div>
                            <div class="stat-label">Upcoming Events</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--success);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="teamMembersCount">0</div>
                            <div class="stat-label">Team Members</div>
                        </div>
                    </div>
                </div>

                <!-- My Tasks Section -->
                <div class="overview-section">
                    <div class="overview-section-header">
                        <h2><i class="fas fa-tasks"></i> My Tasks</h2>
                        <button class="btn-link" onclick="switchTab('tasks')">View All →</button>
                    </div>
                    <div id="overviewTasksList" class="overview-tasks">
                        <p style="text-align: center; color: var(--text-muted); padding: 20px;">No tasks assigned to you</p>
                    </div>
                </div>

                <!-- Upcoming Events Section -->
                <div class="overview-section">
                    <div class="overview-section-header">
                        <h2><i class="fas fa-calendar-check"></i> Upcoming Events</h2>
                        <button class="btn-link" onclick="switchTab('calendar')">View Calendar →</button>
                    </div>
                    <div id="overviewEventsList" class="overview-events">
                        <p style="text-align: center; color: var(--text-muted); padding: 20px;">No upcoming events</p>
                    </div>
                </div>

                <!-- Link Lobby Section (moved above Recent Activity) -->
                <div class="overview-section link-lobby-section">
                    <div class="overview-section-header">
                        <h2><i class="fas fa-link"></i> Link Lobby</h2>
                        <button class="btn-primary btn-sm" id="addLinkGroupBtn">
                            <i class="fas fa-plus"></i> Add Group
                        </button>
                    </div>
                    <div class="link-lobby-container" id="linkLobbyContainer">
                        <!-- Link groups will be rendered here by JS -->
                        <div class="link-lobby-empty" id="linkLobbyEmpty">
                            <div class="link-lobby-empty-icon">
                                <i class="fas fa-folder-plus"></i>
                            </div>
                            <h3>No link groups yet</h3>
                            <p>Create a group to start organizing your links</p>
                            <button class="btn-primary" onclick="openAddGroupModal()">
                                <i class="fas fa-plus"></i> Create First Group
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity Section -->
                <div class="overview-section">
                    <div class="overview-section-header">
                        <h2><i class="fas fa-history"></i> Recent Activity</h2>
                        <button id="seeAllActivitiesBtn" class="btn-link" style="display: none;">See All</button>
                    </div>
                    <div class="activity-feed" id="activityFeed">
                        <!-- Activities rendered by JS -->
                    </div>
                </div>
            </section>

            <!-- Team Section -->
            <section class="content-section" id="team-section">
                <div class="section-header">
                    <div class="section-header-content">
                        <h1>Team Management</h1>
                        <p class="section-subtitle">Manage your team members, view roles, and handle join requests</p>
                        <div id="currentUserRoleDisplay" style="margin-top: 8px; display: none;">
                            <span style="font-size: 14px; color: var(--text-muted);">Your role: </span>
                            <span id="currentUserRoleBadge" class="member-role-badge member">MEMBER</span>
                        </div>
                    </div>
                    <div class="section-header-actions">
                        <button class="btn-primary" id="joinTeamHeaderBtn" onclick="openJoinTeamModal()" style="display: none;">
                            <i class="fas fa-sign-in-alt"></i>
                            Join Team
                        </button>
                    </div>
                </div>

                <!-- Team Overview Card (shown when user has a team) -->
                <div id="teamOverviewCard" class="team-overview-card" style="display: none;">
                    <div class="team-overview-header">
                        <div class="team-overview-info">
                            <!-- Editable Team Name (Owner-only) -->
                            <div class="team-name-wrapper">
                                <h2 id="teamNameDisplay" class="team-name-text">My Team</h2>
                                <button id="editTeamNameBtn" class="btn-edit-team-name" title="Rename team" style="display: none;">
                                    <i class="fas fa-pen"></i>
                                </button>
                            </div>
                            <!-- Inline Edit Input (hidden by default) -->
                            <div id="teamNameEditWrapper" class="team-name-edit-wrapper" style="display: none;">
                                <input type="text" id="teamNameInput" class="team-name-input" maxlength="50" placeholder="Team name">
                                <button id="saveTeamNameBtn" class="btn-save-team-name" title="Save">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button id="cancelTeamNameBtn" class="btn-cancel-team-name" title="Cancel">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="team-meta">
                                <span class="team-code-display">
                                    <i class="fas fa-key"></i>
                                    <span id="teamCodeDisplay">------</span>
                                    <button class="btn-copy-code" onclick="copyTeamCode()" title="Copy team code">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                    <button class="btn-copy-code" onclick="generateJoinLink()" title="Copy join link">
                                        <i class="fas fa-link"></i>
                                    </button>
                                </span>
                                <span class="team-member-count">
                                    <i class="fas fa-users"></i>
                                    <span id="teamMemberCount">0</span> members
                                </span>
                            </div>
                        </div>
                        <div class="team-overview-actions">
                            <button class="btn-secondary btn-leave-team" id="leaveTeamBtn" onclick="leaveTeam()" style="display: none;">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Leave Team</span>
                            </button>
                        </div>
                    </div>

                    <!-- Pending Join Requests (shown for team members) -->
                    <div id="joinRequestsSection" class="join-requests-section" style="display: none;">
                        <div class="section-title">
                            <h3><i class="fas fa-inbox"></i> Join Requests</h3>
                            <span class="badge" id="requestCountBadge">0</span>
                        </div>
                        <div id="joinRequestsList" class="join-requests-list">
                            <!-- Join requests will be added here dynamically -->
                        </div>
                    </div>

                    <!-- Role Information - Collapsible Dropdown -->
                    <details id="roleInfoSection" class="role-info-card" style="display: none;">
                        <summary class="role-info-summary">
                            <i class="fas fa-shield-alt"></i>
                            <span>About Team Roles</span>
                            <i class="fas fa-chevron-down"></i>
                        </summary>
                        <div class="role-info-list">
                            <div class="role-info-item">
                                <div class="role-info-icon owner">
                                    <i class="fas fa-crown"></i>
                                </div>
                                <div class="role-info-content">
                                    <span class="role-info-name">Owner</span>
                                    <span class="role-info-desc">Full control: rename team, manage all members and roles</span>
                                </div>
                            </div>
                            <div class="role-info-item">
                                <div class="role-info-icon admin">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="role-info-content">
                                    <span class="role-info-name">Admin</span>
                                    <span class="role-info-desc">Invite members, approve requests, manage tasks & events</span>
                                </div>
                            </div>
                            <div class="role-info-item">
                                <div class="role-info-icon member">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="role-info-content">
                                    <span class="role-info-name">Member</span>
                                    <span class="role-info-desc">Chat, create tasks & events, view team info</span>
                                </div>
                            </div>
                        </div>
                    </details>

                    <!-- Team Members Grid -->
                    <div class="section-title">
                        <h3><i class="fas fa-users"></i> Team Members</h3>
                    </div>
                    <div class="team-members-grid" id="teamMembersGrid">
                        <!-- Team member cards will be added here dynamically -->
                    </div>
                </div>

                <!-- No Team State (shown when user doesn't have a team) -->
                <div id="noTeamCard" class="no-team-card" style="display: none;">
                    <div class="no-team-illustration">
                        <i class="fas fa-users-slash"></i>
                    </div>
                    <h2>You're not part of a team yet</h2>
                    <p>Create your own team or join an existing one with a team code</p>
                    
                    <div class="no-team-actions">
                        <div class="action-card">
                            <div class="action-icon">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <h3>Create a Team</h3>
                            <p>Start your own team and invite others to join</p>
                            <button class="btn-primary" onclick="createNewTeamNow()">
                                <i class="fas fa-plus"></i>
                                Create Team
                            </button>
                        </div>
                        
                        <div class="action-card">
                            <div class="action-icon">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <h3>Join a Team</h3>
                            <p>Enter a team code to join an existing team</p>
                            <div class="join-team-form">
                                <input type="text" id="joinTeamCodeInput" placeholder="TEAM-ABC123 or ABC123" maxlength="11" style="text-transform: uppercase;">
                                <button class="btn-primary" onclick="joinTeamWithCodeInput()">
                                    <i class="fas fa-arrow-right"></i>
                                    Join
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Chat Section -->
            <section class="content-section" id="chat-section">
                <div class="section-header" style="padding: 0; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                    <h1 style="margin: 0; font-size: 1.2rem;">Team Chat</h1>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <!-- Mentions filter toggle -->
                        <div class="chat-filter-toggle" id="chatFilterToggle">
                            <button class="filter-btn active" data-filter="all">All</button>
                            <button class="filter-btn" data-filter="mentions">@Me</button>
                        </div>
                        <button id="clearAllMessagesBtn" class="btn-secondary" style="display: none; padding: 6px 12px; font-size: 0.85rem;">
                            <i class="fas fa-trash-alt"></i> Clear All
                        </button>
                    </div>
                </div>
                
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will be dynamically added here -->
                        <div class="message">
                            <div class="message-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-author">Sarah Chen</span>
                                    <span class="message-time">10:30 AM</span>
                                </div>
                                <div class="message-text">Hey team! The new design mockups are ready for review.</div>
                            </div>
                        </div>
                        
                        <div class="message">
                            <div class="message-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-author">Mike Johnson</span>
                                    <span class="message-time">10:35 AM</span>
                                </div>
                                <div class="message-text">Great! I'll take a look this afternoon.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-wrapper">
                        <!-- Mention dropdown - positioned above input -->
                        <div class="mention-dropdown" id="mentionDropdown" style="display: none;">
                            <!-- Mention items will be populated dynamically -->
                        </div>
                        <!-- Reply preview bar - shown when replying to a message -->
                        <div class="reply-preview-bar" id="replyPreviewBar" style="display: none;">
                            <div class="reply-preview-content">
                                <i class="fas fa-reply reply-icon"></i>
                                <div class="reply-preview-text">
                                    <span class="reply-to-name" id="replyToName">Replying to Someone</span>
                                    <span class="reply-to-preview" id="replyToPreview">Message preview...</span>
                                </div>
                            </div>
                            <button class="reply-cancel-btn" id="replyCancelBtn" title="Cancel reply">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="chat-input-container">
                            <input type="text" class="chat-input" id="chatInput" placeholder="Type a message... (use @ to mention, /r to reply)">
                            <button class="send-btn" id="sendMessageBtn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Calendar Section -->
            <section class="content-section" id="calendar-section">
                <div class="section-header">
                    <h1>Team Calendar</h1>
                    <p class="section-subtitle">Schedule and manage team events</p>
                    <button class="btn-primary" id="addEventBtn">
                        <i class="fas fa-plus"></i> Add Event
                    </button>
                </div>
                
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="calendar-nav-btn" id="prevMonth">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h2 class="calendar-title" id="calendarTitle">October 2025</h2>
                        <button class="calendar-nav-btn" id="nextMonth">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <!-- View toggle buttons will be added here dynamically -->
                    </div>
                    
                    <div class="calendar-grid">
                        <div class="calendar-day-header">Mon</div>
                        <div class="calendar-day-header">Tue</div>
                        <div class="calendar-day-header">Wed</div>
                        <div class="calendar-day-header">Thu</div>
                        <div class="calendar-day-header">Fri</div>
                        <div class="calendar-day-header">Sat</div>
                        <div class="calendar-day-header">Sun</div>
                        <!-- Calendar days/week view will be dynamically generated -->
                        <div id="calendarDays"></div>
                    </div>
                </div>
            </section>

            <!-- Sheets Section -->
            <section class="content-section" id="tasks-section">
                <!-- Spreadsheet Header -->
                <div class="spreadsheet-header">
                    <div class="spreadsheet-header-left">
                        <h3><i class="fas fa-table-cells"></i> Your Sheets</h3>
                        <p class="spreadsheet-subtitle">Organize and track your team's work</p>
                    </div>
                    <button class="btn-primary" id="addTaskBtn">
                        <i class="fas fa-plus"></i> Add Row
                    </button>
                </div>

                <!-- Spreadsheet Cards Grid -->
                <div class="spreadsheet-cards" id="spreadsheetCards">
                    <!-- Spreadsheet cards will be rendered by JS -->
                    <div class="spreadsheet-card create-new" id="createSpreadsheetCard">
                        <div class="spreadsheet-card-icon"><i class="fas fa-plus"></i></div>
                        <span>Create Spreadsheet</span>
                    </div>
                </div>

                <!-- Full-screen Spreadsheet Panel -->
                <div class="spreadsheet-panel" id="spreadsheetPanel">
                    <div class="spreadsheet-panel-header">
                        <div class="panel-header-left">
                            <button class="back-btn" id="spreadsheetBackBtn">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <button class="icon-btn" id="openSidebarBtn">
                                <i class="fas fa-columns"></i>
                            </button>
                            <div class="spreadsheet-title-group">
                                <div class="spreadsheet-icon-preview" id="spreadsheetIconPreview">
                                    <i class="fas fa-table"></i>
                                </div>
                                <input type="text" class="spreadsheet-title-input" value="All Tasks" placeholder="Spreadsheet name">
                            </div>
                        </div>
                        <div class="panel-header-right">
                            <button class="icon-btn primary" id="addTaskPanelBtn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Batch Actions Bar (hidden by default) -->
                    <div class="batch-actions-bar" id="batchActionsBar">
                        <div class="batch-info">
                            <span id="selectedCount">0</span> <span id="selectedItemsLabel">tasks</span> selected
                        </div>
                        <div class="batch-buttons">
                            <button class="batch-btn" onclick="batchMarkDone()">
                                <i class="fas fa-check"></i> Mark Done
                            </button>
                            <button class="batch-btn" onclick="batchChangeStatus()">
                                <i class="fas fa-sync"></i> Change Status
                            </button>
                            <button class="batch-btn danger" onclick="batchDelete()">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                        <button class="batch-close" onclick="clearSelection()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="spreadsheet-panel-body">
                        <!-- Column Toggle Sidebar -->
                        <div class="column-toggle-sidebar" id="columnSidebar">
                            <div class="sidebar-header">
                                <button class="add-column-btn" id="addColumnBtn" title="Add column">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <h4>Columns</h4>
                                <button class="sidebar-toggle" id="toggleSidebar">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                            </div>
                            <div class="sidebar-section">
                                <div class="column-toggles" id="columnToggles">
                                    <!-- Column toggles will be rendered by JS -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Spreadsheet Table Area -->
                        <div class="spreadsheet-table-area">
                            <div class="table-container" id="tableContainer">
                                <!-- Table will be rendered by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Metrics Section -->
            <section class="content-section" id="metrics-section">
                <div class="section-header">
                    <div>
                        <h1>Metrics</h1>
                        <p class="section-subtitle">Track performance across tasks, events and teamwork.</p>
                    </div>
                    <!-- Date range / user selector filters will be added later -->
                </div>
                <div id="metricsContent" class="metrics-layout">
                    <!-- Metrics cards & charts will be rendered here by JS -->
                    <div class="metrics-placeholder-state">
                        <div class="metrics-placeholder-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Performance Metrics</h3>
                        <p>Track your team's productivity, task completion rates, and activity trends.</p>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="content-section" id="settings-section">
                <div class="section-header">
                    <h1>Settings</h1>
                    <p class="section-subtitle">Manage your account and preferences</p>
                </div>

                    <!-- Profile Picture Card -->
                    <div class="settings-card" id="settings-profile-section">
                        <div class="settings-card-header">
                            <h2><i class="fas fa-image"></i> Profile Picture</h2>
                            <p>Update your avatar for chat and team lists</p>
                        </div>
                        <div class="settings-card-body">
                            <div class="avatar-settings-preview">
                                <div class="profile-avatar-large" id="avatarSettingsPreview">
                                    <!-- Avatar image or initials will be rendered here by JS -->
                                </div>
                            </div>
                            <button type="button" class="btn-primary" id="uploadAvatarBtn" style="margin-top: 16px;">
                                Upload new avatar
                            </button>
                            <input type="file" id="avatarFileInput" accept="image/*" style="display: none;">
                            <small style="display: block; margin-top: 12px; color: var(--text-muted);">We recommend a square image under 2 MB.</small>
                        </div>
                    </div>
                <!-- Account Settings Card -->
                <div class="settings-container">
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h2><i class="fas fa-user-circle"></i> My Account</h2>
                            <p>Update your personal information and profile settings</p>
                        </div>

                        <div class="settings-card-body">
                            <!-- Profile Preview -->
                            <div class="profile-preview">
                                <div class="profile-avatar-large" id="profileAvatarPreview">
                                    <span id="profileAvatarText">JD</span>
                                </div>
                                <div class="profile-preview-info">
                                    <h3 id="profilePreviewName">John Doe</h3>
                                    <p id="profilePreviewEmail">john@example.com</p>
                                </div>
                            </div>

                            <!-- Account Form -->
                            <form id="accountSettingsForm" class="settings-form">
                                <div class="form-section">
                                    <h3 class="form-section-title">Personal Information</h3>
                                    
                                    <div class="form-group">
                                        <label for="settingsDisplayName">
                                            <i class="fas fa-user"></i> Display Name
                                        </label>
                                        <input type="text" id="settingsDisplayName" placeholder="Enter your name" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="settingsEmail">
                                            <i class="fas fa-envelope"></i> Email Address
                                        </label>
                                        <input type="email" id="settingsEmail" placeholder="your@email.com" readonly disabled>
                                        <small>Email cannot be changed</small>
                                    </div>

                                    <div class="form-group">
                                        <label for="settingsJobTitle">
                                            <i class="fas fa-briefcase"></i> Job Title / Position
                                        </label>
                                        <input type="text" id="settingsJobTitle" placeholder="e.g. Senior Developer, Project Manager">
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3 class="form-section-title">Avatar Customization</h3>
                                    
                                    <div class="form-group">
                                        <label>
                                            <i class="fas fa-palette"></i> Avatar Color
                                        </label>
                                        <div class="avatar-color-picker">
                                            <!-- Red to Pink -->
                                            <div class="color-option" data-color="#FF3B30" style="background: linear-gradient(135deg, #FF3B30 0%, #d62a21 100%);"></div>
                                            <div class="color-option" data-color="#FF6B6B" style="background: linear-gradient(135deg, #FF6B6B 0%, #e64545 100%);"></div>
                                            <div class="color-option" data-color="#FF2D55" style="background: linear-gradient(135deg, #FF2D55 0%, #d9214a 100%);"></div>
                                            <!-- Orange to Yellow -->
                                            <div class="color-option" data-color="#FF9500" style="background: linear-gradient(135deg, #FF9500 0%, #e68600 100%);"></div>
                                            <div class="color-option" data-color="#FFCC00" style="background: linear-gradient(135deg, #FFCC00 0%, #e6b800 100%);"></div>
                                            <!-- Green -->
                                            <div class="color-option" data-color="#34C759" style="background: linear-gradient(135deg, #34C759 0%, #2da84d 100%);"></div>
                                            <div class="color-option" data-color="#00C7BE" style="background: linear-gradient(135deg, #00C7BE 0%, #00a89f 100%);"></div>
                                            <!-- Blue -->
                                            <div class="color-option" data-color="#007AFF" style="background: linear-gradient(135deg, #007AFF 0%, #0062cc 100%);"></div>
                                            <div class="color-option" data-color="#5AC8FA" style="background: linear-gradient(135deg, #5AC8FA 0%, #32b4e8 100%);"></div>
                                            <!-- Purple to Gray -->
                                            <div class="color-option" data-color="#AF52DE" style="background: linear-gradient(135deg, #AF52DE 0%, #9742c4 100%);"></div>
                                            <div class="color-option" data-color="#5856D6" style="background: linear-gradient(135deg, #5856D6 0%, #4644b8 100%);"></div>
                                            <div class="color-option" data-color="#8E8E93" style="background: linear-gradient(135deg, #8E8E93 0%, #636366 100%);"></div>
                                        </div>
                                        <input type="hidden" id="settingsAvatarColor" value="#0078D4">
                                        
                                        <!-- Avatar Upload Button (moved here from separate card) -->
                                        <div class="avatar-upload-inline">
                                            <button type="button" class="btn-secondary" id="uploadAvatarBtnInline">
                                                <i class="fas fa-camera"></i> Upload Photo
                                            </button>
                                            <input type="file" id="avatarFileInputInline" accept="image/*" style="display: none;">
                                            <small class="avatar-upload-hint">Square image recommended, max 2MB</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="button" class="btn-secondary" onclick="cancelSettings()">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                    <button type="submit" class="btn-primary">
                                        <i class="fas fa-save"></i> Save Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Advanced Settings Card (Admin/Owner Only) -->
                    <div class="settings-card" id="settings-chat-appearance-section" style="margin-top: 20px; display: none;">
                        <div class="settings-card-header">
                            <h2><i class="fas fa-cog"></i> Advanced Settings</h2>
                            <p>Customize chat appearance and other advanced options (Admin/Owner only)</p>
                        </div>
                        <div class="settings-card-body">
                            <form id="chatAppearanceForm" class="settings-form">
                                <div class="form-section">
                                    <h3 class="form-section-title"><i class="fas fa-comments"></i> Chat Appearance</h3>
                                    
                                    <!-- Toggle: Show avatars -->
                                    <div class="form-group toggle-group">
                                        <label class="toggle-label">
                                            <div class="toggle-label-content">
                                                <div class="toggle-label-text">
                                                    <i class="fas fa-user-circle"></i> Show avatars in chat
                                                </div>
                                                <small>Display user avatars next to messages</small>
                                            </div>
                                            <div class="toggle-switch">
                                                <input type="checkbox" id="chatShowAvatars" checked>
                                                <span class="toggle-slider"></span>
                                            </div>
                                        </label>
                                    </div>

                                    <!-- Toggle: Compact mode -->
                                    <div class="form-group toggle-group">
                                        <label class="toggle-label">
                                            <div class="toggle-label-content">
                                                <div class="toggle-label-text">
                                                    <i class="fas fa-compress-alt"></i> Compact chat layout
                                                </div>
                                                <small>Reduce spacing between messages for a denser view</small>
                                            </div>
                                            <div class="toggle-switch">
                                                <input type="checkbox" id="chatCompactMode">
                                                <span class="toggle-slider"></span>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3 class="form-section-title">Message Style</h3>
                                    
                                    <!-- Radio: Timestamp style -->
                                    <div class="form-group">
                                        <label>
                                            <i class="fas fa-clock"></i> Timestamp style
                                        </label>
                                        <div class="radio-group">
                                            <label class="radio-option">
                                                <input type="radio" name="timestampStyle" value="inline" checked>
                                                <span class="radio-custom"></span>
                                                <span class="radio-label">Inline</span>
                                                <small>Show timestamps next to sender name</small>
                                            </label>
                                            <label class="radio-option">
                                                <input type="radio" name="timestampStyle" value="subtle">
                                                <span class="radio-custom"></span>
                                                <span class="radio-label">Subtle</span>
                                                <small>Show timestamps below sender name</small>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Radio: Bubble style -->
                                    <div class="form-group">
                                        <label>
                                            <i class="fas fa-comment-dots"></i> Bubble style
                                        </label>
                                        <div class="radio-group">
                                            <label class="radio-option">
                                                <input type="radio" name="bubbleStyle" value="filled" checked>
                                                <span class="radio-custom"></span>
                                                <span class="radio-label">Filled bubbles</span>
                                                <small>Solid background color</small>
                                            </label>
                                            <label class="radio-option">
                                                <input type="radio" name="bubbleStyle" value="minimal">
                                                <span class="radio-custom"></span>
                                                <span class="radio-label">Minimal outline</span>
                                                <small>Transparent with border</small>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="button" class="btn-secondary" onclick="resetChatAppearance()">
                                        <i class="fas fa-undo"></i> Reset to Defaults
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Motion & Animations Card (Admin/Owner Only) -->
                    <div class="settings-card" id="animationsSettingsCard" style="margin-top: 20px; display: none;">
                        <div class="settings-card-header">
                            <h2><i class="fas fa-magic"></i> Motion & Animations</h2>
                            <p>Control animation and motion effects (Admin/Owner only)</p>
                        </div>
                        <div class="settings-card-body">
                            <form id="animationsForm" class="settings-form">
                                <!-- Toggle: Enable animations -->
                                <div class="form-group toggle-group">
                                    <label class="toggle-label">
                                        <div class="toggle-label-content">
                                            <div class="toggle-label-text">
                                                <i class="fas fa-wand-magic-sparkles"></i> Enable animations
                                            </div>
                                            <small>Enable smooth transitions and animations throughout the app</small>
                                        </div>
                                        <div class="toggle-switch">
                                            <input type="checkbox" id="enableAnimations" checked>
                                            <span class="toggle-slider"></span>
                                        </div>
                                    </label>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Appearance Settings Card -->
                    <div class="settings-card" id="settings-appearance-section" style="margin-top: 20px;">
                        <div class="settings-card-header">
                            <h2><i class="fas fa-palette"></i> Appearance</h2>
                            <p>Customize the visual theme of your workspace</p>
                        </div>
                        <div class="settings-card-body">
                            <form id="appearanceForm" class="settings-form">
                                <!-- Toggle: Dark Mode -->
                                <div class="form-group toggle-group">
                                    <label class="toggle-label">
                                        <div class="toggle-label-content">
                                            <div class="toggle-label-text">
                                                <i class="fas fa-moon"></i> Dark mode
                                            </div>
                                            <small>Switch between light and dark color schemes</small>
                                        </div>
                                        <div class="toggle-switch">
                                            <input type="checkbox" id="darkModeToggle">
                                            <span class="toggle-slider"></span>
                                        </div>
                                    </label>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Notification Preferences Card -->
                    <div class="settings-card" id="settings-notifications-section" style="margin-top: 20px;">
                        <div class="settings-card-header">
                            <h2><i class="fas fa-bell"></i> Notification Preferences</h2>
                            <p>Choose which notifications you want to receive</p>
                        </div>
                        <div class="settings-card-body">
                            <form id="notificationsForm" class="settings-form">
                                <!-- Task Notifications Section -->
                                <div class="notification-prefs-section">
                                    <div class="notification-prefs-header">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Task Notifications</span>
                                    </div>
                                    <div class="notification-prefs-toggles">
                                        <label class="toggle-label compact">
                                            <div class="toggle-label-content">
                                                <div class="toggle-label-text">Assigned to you</div>
                                                <small>When a task is assigned to you</small>
                                            </div>
                                            <div class="toggle-switch">
                                                <input type="checkbox" id="notifTaskAssigned" checked>
                                                <span class="toggle-slider"></span>
                                            </div>
                                        </label>
                                        <label class="toggle-label compact">
                                            <div class="toggle-label-content">
                                                <div class="toggle-label-text">Updated tasks</div>
                                                <small>When tasks you're involved in are updated</small>
                                            </div>
                                            <div class="toggle-switch">
                                                <input type="checkbox" id="notifTaskUpdated" checked>
                                                <span class="toggle-slider"></span>
                                            </div>
                                        </label>
                                        <label class="toggle-label compact">
                                            <div class="toggle-label-content">
                                                <div class="toggle-label-text">Completed tasks</div>
                                                <small>When tasks are marked as done</small>
                                            </div>
                                            <div class="toggle-switch">
                                                <input type="checkbox" id="notifTaskCompleted">
                                                <span class="toggle-slider"></span>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Chat Notifications Section -->
                                <div class="notification-prefs-section">
                                    <div class="notification-prefs-header">
                                        <i class="fas fa-comment"></i>
                                        <span>Chat Notifications</span>
                                    </div>
                                    <div class="notification-prefs-toggles">
                                        <label class="toggle-label compact">
                                            <div class="toggle-label-content">
                                                <div class="toggle-label-text">Mentions (@you)</div>
                                                <small>When someone mentions you in chat</small>
                                            </div>
                                            <div class="toggle-switch">
                                                <input type="checkbox" id="notifChatMentions" checked>
                                                <span class="toggle-slider"></span>
                                            </div>
                                        </label>
                                        <label class="toggle-label compact">
                                            <div class="toggle-label-content">
                                                <div class="toggle-label-text">Direct replies</div>
                                                <small>When someone replies to your messages</small>
                                            </div>
                                            <div class="toggle-switch">
                                                <input type="checkbox" id="notifChatReplies" checked>
                                                <span class="toggle-slider"></span>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Team Activity Notifications Section -->
                                <div class="notification-prefs-section">
                                    <div class="notification-prefs-header">
                                        <i class="fas fa-users"></i>
                                        <span>Team Activity Notifications</span>
                                    </div>
                                    <div class="notification-prefs-toggles">
                                        <label class="toggle-label compact">
                                            <div class="toggle-label-content">
                                                <div class="toggle-label-text">New members joined</div>
                                                <small>When someone joins your team</small>
                                            </div>
                                            <div class="toggle-switch">
                                                <input type="checkbox" id="notifTeamMembers" checked>
                                                <span class="toggle-slider"></span>
                                            </div>
                                        </label>
                                        <label class="toggle-label compact">
                                            <div class="toggle-label-content">
                                                <div class="toggle-label-text">Team settings changes</div>
                                                <small>When team settings or roles are updated</small>
                                            </div>
                                            <div class="toggle-switch">
                                                <input type="checkbox" id="notifTeamChanges">
                                                <span class="toggle-slider"></span>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Security Settings Card -->
                    <div class="settings-card" id="settings-security-section" style="margin-top: 20px;">
                        <div class="settings-card-header">
                            <h2><i class="fas fa-shield-halved"></i> Security</h2>
                            <p>Manage your account security and sessions</p>
                        </div>
                        <div class="settings-card-body">
                            <div class="settings-form">
                                <!-- Change Password -->
                                <div class="form-group">
                                    <label>
                                        <i class="fas fa-key"></i> Change Password
                                    </label>
                                    <small style="margin-bottom: 16px; display: block;">Send a password reset link to your email address</small>
                                    <button type="button" class="btn-secondary" onclick="sendPasswordResetFromSettings()">
                                        <i class="fas fa-envelope"></i> Send Reset Link
                                    </button>
                                </div>

                                <!-- Session Management -->
                                <div class="form-group">
                                    <label>
                                        <i class="fas fa-right-from-bracket"></i> Session Management
                                    </label>
                                    <small style="margin-bottom: 16px; display: block;">Sign out from all devices and browsers where you're currently logged in</small>
                                    <button type="button" class="btn-danger" onclick="showLogoutAllModal()">
                                        <i class="fas fa-power-off"></i> Log out of all devices
                                    </button>
                                </div>

                                <!-- Delete Chat History (Owner Only) -->
                                <div class="form-group" id="deleteChatHistorySection" style="display: none;">
                                    <label>
                                        <i class="fas fa-trash-alt"></i> Delete Chat History
                                    </label>
                                    <small style="margin-bottom: 16px; display: block; color: #d32f2f;">Owner only: Permanently delete all messages from the team chat. This cannot be undone.</small>
                                    <button type="button" class="btn-danger" onclick="showDeleteChatHistoryModal()">
                                        <i class="fas fa-trash-alt"></i> Delete All Messages
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Metrics & Stats Visibility Card (Owner Only) -->
                    <div class="settings-card" id="metricsSettingsCard" style="margin-top: 20px; display: none;">
                        <div class="settings-card-header">
                            <h2><i class="fas fa-chart-line"></i> Metrics & Stats Visibility</h2>
                            <p>Control who can see performance metrics for this team (Owner only)</p>
                        </div>
                        <div class="settings-card-body">
                            <form id="metricsVisibilityForm" class="settings-form">
                                <div class="form-group">
                                    <label>
                                        <i class="fas fa-eye"></i> Who can see metrics?
                                    </label>
                                    <div class="radio-group-vertical">
                                        <label class="radio-option">
                                            <input type="radio" name="metricsVisibility" value="owner-only">
                                            <div class="radio-option-content">
                                                <span class="radio-option-title">Owner only</span>
                                                <span class="radio-option-desc">Only you can see all metrics and team stats</span>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="metricsVisibility" value="admin-owner">
                                            <div class="radio-option-content">
                                                <span class="radio-option-title">Owner & Admins</span>
                                                <span class="radio-option-desc">Owner and team admins can see all metrics</span>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="metricsVisibility" value="members-own">
                                            <div class="radio-option-content">
                                                <span class="radio-option-title">Members see own stats</span>
                                                <span class="radio-option-desc">Everyone can access metrics, but members only see their own data</span>
                                            </div>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="metricsVisibility" value="everyone">
                                            <div class="radio-option-content">
                                                <span class="radio-option-title">Everyone</span>
                                                <span class="radio-option-desc">All team members can see full team metrics</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-actions" style="margin-top: 16px;">
                                    <button type="submit" class="btn-primary">
                                        <i class="fas fa-save"></i> Save Metrics Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Modal for Logout All Devices - Unified Style -->
    <div class="unified-modal" id="logoutAllModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-shield-halved"></i> Log Out Everywhere</h2>
                </div>
                <button class="unified-modal-close" id="closeLogoutAllModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box warning">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-power-off"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Sign out from all devices?</p>
                        <p class="unified-confirm-text">
                            You will be signed out from all devices and browsers where you're currently logged in, including this one.
                        </p>
                        <p class="unified-confirm-text" style="margin-top: 8px;">
                            You'll need to sign in again on each device you want to use.
                        </p>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" id="cancelLogoutAll">Cancel</button>
                <button class="unified-btn unified-btn-danger" id="confirmLogoutAll">
                    <i class="fas fa-power-off"></i> Log Out Everywhere
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Delete Chat History - Unified Style -->
    <div class="unified-modal" id="deleteChatHistoryModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-trash-alt"></i> Delete Chat History</h2>
                </div>
                <button class="unified-modal-close" id="closeDeleteChatHistoryModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box danger">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title" style="color: #ff3b30;">⚠️ PERMANENT ACTION</p>
                        <p class="unified-confirm-text">
                            This will permanently delete all team messages.
                        </p>
                        <p class="unified-confirm-text" style="font-weight: 600; color: #ff3b30; margin-top: 8px;">
                            This action cannot be undone.
                        </p>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" id="cancelDeleteChatHistory">Cancel</button>
                <button class="unified-btn unified-btn-danger" id="confirmDeleteChatHistory">
                    <i class="fas fa-trash-alt"></i> Delete All Messages
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Promoting Member - Unified Style -->
    <div class="unified-modal" id="promoteModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-arrow-up"></i> Promote to Admin</h2>
                </div>
                <button class="unified-modal-close" onclick="closePromoteModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box info">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Promote <strong id="promoteMemberName"></strong> to Admin?</p>
                        <p class="unified-confirm-text">Admins have elevated permissions in the team.</p>
                        <ul class="unified-feature-list">
                            <li><i class="fas fa-check"></i> Invite new members</li>
                            <li><i class="fas fa-check"></i> Approve/deny join requests</li>
                            <li><i class="fas fa-check"></i> Manage tasks and events</li>
                            <li class="muted"><i class="fas fa-times"></i> Cannot change owner or other admin roles</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" onclick="closePromoteModal()">Cancel</button>
                <button class="unified-btn unified-btn-primary" id="confirmPromote">
                    <i class="fas fa-arrow-up"></i> Promote to Admin
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Demoting Member - Unified Style -->
    <div class="unified-modal" id="demoteModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-arrow-down"></i> Demote to Member</h2>
                </div>
                <button class="unified-modal-close" onclick="closeDemoteModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box warning">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Demote <strong id="demoteMemberName"></strong> to Member?</p>
                        <p class="unified-confirm-text">They will lose the following privileges:</p>
                        <ul class="unified-feature-list">
                            <li class="muted"><i class="fas fa-times"></i> Ability to invite new members</li>
                            <li class="muted"><i class="fas fa-times"></i> Ability to approve/deny join requests</li>
                            <li class="muted"><i class="fas fa-times"></i> Admin management privileges</li>
                            <li><i class="fas fa-check"></i> Will remain as a regular team member</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" onclick="closeDemoteModal()">Cancel</button>
                <button class="unified-btn unified-btn-warning" id="confirmDemote">
                    <i class="fas fa-arrow-down"></i> Demote to Member
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Kicking Member - Unified Style -->
    <div class="unified-modal" id="kickModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-user-times"></i> Kick Member</h2>
                </div>
                <button class="unified-modal-close" onclick="closeKickModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box danger">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-triangle-exclamation"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Remove <strong id="kickMemberName"></strong> from the team?</p>
                        <p class="unified-confirm-text">
                            This will immediately remove them from the team and revoke all access.
                        </p>
                        <p class="unified-confirm-text" style="font-weight: 600; color: #ff3b30; margin-top: 8px;">
                            This action cannot be undone.
                        </p>
                    </div>
                </div>
            </div>
            <div class="unified-modal-footer">
                <button class="unified-btn unified-btn-secondary" onclick="closeKickModal()">Cancel</button>
                <button class="unified-btn unified-btn-danger" id="confirmKick">
                    <i class="fas fa-user-times"></i> Kick Member
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Adding Events - Unified Style -->
    <div class="unified-modal" id="eventModal">
        <div class="unified-modal-container">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-calendar-plus"></i> New Event</h2>
                    <p class="subtitle">Schedule an event for your team</p>
                </div>
                <button class="unified-modal-close" id="closeEventModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="eventForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid">
                        <!-- Event Title - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Event Title <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="eventTitle" required placeholder="Enter event name">
                        </div>
                        
                        <!-- Date -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-calendar"></i> Date <span class="required">*</span>
                            </label>
                            <input type="date" class="unified-input" id="eventDate" required>
                        </div>
                        
                        <!-- Duration Display -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-hourglass-half"></i> Duration
                            </label>
                            <div class="unified-input" style="background: var(--bg-surface-soft); color: var(--text-muted);" id="eventDuration">
                                <span id="durationText">0 minutes</span>
                            </div>
                        </div>
                        
                        <!-- Start Time -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-clock"></i> Start Time <span class="required">*</span>
                            </label>
                            <div class="unified-time-input">
                                <input type="number" id="eventHour" min="0" max="23" placeholder="09" required>
                                <span>:</span>
                                <input type="number" id="eventMinute" min="0" max="59" placeholder="00" required>
                            </div>
                        </div>
                        
                        <!-- End Time -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-clock"></i> End Time <span class="required">*</span>
                            </label>
                            <div class="unified-time-input">
                                <input type="number" id="eventEndHour" min="0" max="23" placeholder="17" required>
                                <span>:</span>
                                <input type="number" id="eventEndMinute" min="0" max="59" placeholder="00" required>
                            </div>
                        </div>
                        
                        <!-- Color Picker - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-palette"></i> Color
                            </label>
                            <input type="hidden" id="eventColor" value="#007AFF">
                            <div class="unified-color-grid">
                                <button type="button" class="unified-color-option selected" data-color="#007AFF" style="background: #007AFF;" title="Blue"></button>
                                <button type="button" class="unified-color-option" data-color="#5856D6" style="background: #5856D6;" title="Purple"></button>
                                <button type="button" class="unified-color-option" data-color="#32ADE6" style="background: #32ADE6;" title="Teal"></button>
                                <button type="button" class="unified-color-option" data-color="#FF3B30" style="background: #FF3B30;" title="Red"></button>
                                <button type="button" class="unified-color-option" data-color="#34C759" style="background: #34C759;" title="Green"></button>
                                <button type="button" class="unified-color-option" data-color="#FF9500" style="background: #FF9500;" title="Orange"></button>
                                <button type="button" class="unified-color-option" data-color="#FF2D55" style="background: #FF2D55;" title="Pink"></button>
                                <button type="button" class="unified-color-option" data-color="#AF52DE" style="background: #AF52DE;" title="Magenta"></button>
                            </div>
                        </div>
                        
                        <!-- Description - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Description <span class="optional">(optional)</span>
                            </label>
                            <textarea class="unified-textarea" id="eventDescription" rows="2" placeholder="Add details about this event..."></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" id="cancelEventBtn">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary">
                        <i class="fas fa-check"></i> Add Event
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Event Details -->
    <div class="modal" id="eventDetailsModal">
        <div class="modal-content modal-content-wide">
            <div class="modal-header">
                <h2 id="eventDetailsTitle">Event Details</h2>
                <div class="modal-header-actions">
                    <button class="btn-edit-grey" id="editEventBtnHeader" style="display: none;">
                        <i class="fas fa-pen"></i> Edit
                    </button>
                    <button class="modal-close" id="closeEventDetailsModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="modal-body" style="padding: var(--spacing-xl);">
                <div class="event-details-layout">
                    <div class="event-details-main">
                        <div class="event-detail-row">
                            <div class="event-detail-icon">
                                <i class="fas fa-calendar"></i>
                            </div>
                            <div class="event-detail-content">
                                <div class="event-detail-label">Date</div>
                                <div class="event-detail-value" id="detailDate"></div>
                            </div>
                        </div>
                        <div class="event-detail-row">
                            <div class="event-detail-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="event-detail-content">
                                <div class="event-detail-label">Time</div>
                                <div class="event-detail-value" id="detailTime"></div>
                            </div>
                        </div>
                        <div class="event-detail-row">
                            <div class="event-detail-icon">
                                <i class="fas fa-hourglass-half"></i>
                            </div>
                            <div class="event-detail-content">
                                <div class="event-detail-label">Duration</div>
                                <div class="event-detail-value" id="detailDuration"></div>
                            </div>
                        </div>
                        <div class="event-detail-row">
                            <div class="event-detail-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="event-detail-content">
                                <div class="event-detail-label">Created By</div>
                                <div class="event-detail-value" id="detailCreatedBy"></div>
                            </div>
                        </div>
                        <div class="event-detail-row">
                            <div class="event-detail-icon">
                                <i class="fas fa-palette"></i>
                            </div>
                            <div class="event-detail-content">
                                <div class="event-detail-label">Color</div>
                                <div class="event-color-display" id="detailColor"></div>
                            </div>
                        </div>
                    </div>
                    <div class="event-details-description">
                        <div class="event-detail-label" style="margin-bottom: var(--spacing-sm);"><i class="fas fa-align-left"></i> Description</div>
                        <div class="event-description-box" id="detailDescription"></div>
                    </div>
                </div>
                <div class="modal-actions" id="eventDetailsActions" style="margin-top: var(--spacing-lg); display: none;">
                    <button type="button" class="btn-danger" id="deleteEventBtn">
                        <i class="fas fa-trash"></i> Delete Event
                    </button>
                </div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===================================
         ADD TASK MODAL - Unified Modern Design
         Wide 2-column layout, minimal scrolling
         =================================== -->
    <div class="unified-modal" id="taskModal">
        <div class="unified-modal-container">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-plus-circle"></i> New Task</h2>
                    <p class="subtitle">Add a new task to your team's workflow</p>
                </div>
                <button class="unified-modal-close" id="closeTaskModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="taskForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid">
                        <!-- Task Title - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Title <span class="required">*</span>
                                <span class="optional" id="taskTitleCounter" style="margin-left: auto;">0/20 words</span>
                            </label>
                            <input type="text" class="unified-input" id="taskTitle" required placeholder="What needs to be done?">
                        </div>
                        
                        <!-- Description - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Description <span class="optional">(optional)</span>
                            </label>
                            <textarea class="unified-textarea" id="taskDescription" rows="2" placeholder="Add details or context..."></textarea>
                        </div>
                        
                        <!-- Assignee -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-user"></i> Assignee <span class="required">*</span>
                            </label>
                            <div class="unified-dropdown" id="taskAssigneeDropdown">
                                <div class="unified-dropdown-trigger" id="taskAssigneeTrigger">
                                    <div class="unified-dropdown-value">
                                        <span class="dropdown-placeholder">Select team member...</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="taskAssigneeMenu"></div>
                                <input type="hidden" id="taskAssignee" name="taskAssignee" required>
                            </div>
                        </div>
                        
                        <!-- Due Date -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-calendar"></i> Due Date
                            </label>
                            <input type="date" class="unified-input" id="taskDueDate">
                        </div>
                        
                        <!-- Priority -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-flag"></i> Priority
                            </label>
                            <div class="unified-dropdown" id="taskPriorityDropdown">
                                <div class="unified-dropdown-trigger" id="taskPriorityTrigger">
                                    <div class="unified-dropdown-value">
                                        <span class="unified-priority-dot medium"></span>
                                        <span>Medium</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="taskPriorityMenu">
                                    <div class="unified-dropdown-option" data-value="low">
                                        <span class="unified-priority-dot low"></span>
                                        <span>Low</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option selected" data-value="medium">
                                        <span class="unified-priority-dot medium"></span>
                                        <span>Medium</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="high">
                                        <span class="unified-priority-dot high"></span>
                                        <span>High</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                </div>
                                <input type="hidden" id="taskPriority" name="taskPriority" value="medium">
                            </div>
                        </div>
                        
                        <!-- Status -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-circle-dot"></i> Status
                            </label>
                            <div class="unified-dropdown" id="taskStatusDropdown">
                                <div class="unified-dropdown-trigger" id="taskStatusTrigger">
                                    <div class="unified-dropdown-value">
                                        <span class="unified-status-dot todo"></span>
                                        <span>To Do</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="taskStatusMenu">
                                    <div class="unified-dropdown-option selected" data-value="todo">
                                        <span class="unified-status-dot todo"></span>
                                        <span>To Do</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="inprogress">
                                        <span class="unified-status-dot inprogress"></span>
                                        <span>In Progress</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="done">
                                        <span class="unified-status-dot done"></span>
                                        <span>Done</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                </div>
                                <input type="hidden" id="taskStatus" name="taskStatus" value="todo">
                            </div>
                        </div>
                        
                        <!-- Budget -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-dollar-sign"></i> Budget <span class="optional">(optional)</span>
                            </label>
                            <div class="unified-input-group">
                                <span class="input-addon">$</span>
                                <input type="number" class="unified-input" id="taskBudget" placeholder="0.00" min="0" step="0.01">
                            </div>
                        </div>
                        
                        <!-- Estimated Time -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-clock"></i> Est. Time <span class="optional">(optional)</span>
                            </label>
                            <div class="unified-input-group">
                                <input type="number" class="unified-input" id="taskEstimatedTime" placeholder="0" min="0" step="0.5">
                                <span class="input-addon">hrs</span>
                            </div>
                        </div>
                        
                        <!-- Progress - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-tasks"></i> Progress
                            </label>
                            <div class="unified-progress-control">
                                <div class="unified-progress-track">
                                    <div class="unified-progress-fill" id="taskProgressFill"></div>
                                </div>
                                <div class="unified-progress-value">
                                    <input type="number" id="taskProgress" min="0" max="100" value="0">
                                    <span>%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Spreadsheet Selection - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-table"></i> Add to Spreadsheet
                            </label>
                            <div class="unified-dropdown" id="taskSpreadsheetDropdown">
                                <div class="unified-dropdown-trigger" id="taskSpreadsheetTrigger">
                                    <div class="unified-dropdown-value">
                                        <i class="fas fa-table" style="color: var(--accent);"></i>
                                        <span>All Tasks</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="taskSpreadsheetMenu"></div>
                                <input type="hidden" id="taskSpreadsheet" name="taskSpreadsheet" value="default">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" id="cancelTaskBtn">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary">
                        <i class="fas fa-check"></i> Create Task
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ===================================
         ADD LEAD MODAL - Unified Modern Design
         Wide 2-column layout for lead management
         =================================== -->
    <div class="unified-modal" id="leadModal">
        <div class="unified-modal-container">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-user-plus"></i> New Lead</h2>
                    <p class="subtitle">Add a new lead to your sales pipeline</p>
                </div>
                <button class="unified-modal-close" id="closeLeadModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="leadForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid">
                        <!-- Lead Name - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Lead Name <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="leadName" required placeholder="Enter lead name or company">
                        </div>
                        
                        <!-- Status -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-circle-dot"></i> Status
                            </label>
                            <div class="unified-dropdown" id="leadStatusDropdown">
                                <div class="unified-dropdown-trigger" id="leadStatusTrigger">
                                    <div class="unified-dropdown-value">
                                        <span class="unified-status-dot new"></span>
                                        <span>New</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="leadStatusMenu">
                                    <div class="unified-dropdown-option selected" data-value="New" data-color="#007AFF">
                                        <span class="unified-status-dot new"></span>
                                        <span>New</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Contacted" data-color="#5856D6">
                                        <span class="unified-status-dot contacted"></span>
                                        <span>Contacted</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Qualified" data-color="#FF9500">
                                        <span class="unified-status-dot qualified"></span>
                                        <span>Qualified</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Won" data-color="#34C759">
                                        <span class="unified-status-dot won"></span>
                                        <span>Won</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Lost" data-color="#FF3B30">
                                        <span class="unified-status-dot lost"></span>
                                        <span>Lost</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                </div>
                                <input type="hidden" id="leadStatus" name="leadStatus" value="New">
                            </div>
                        </div>
                        
                        <!-- Source -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-route"></i> Source
                            </label>
                            <div class="unified-dropdown" id="leadSourceDropdown">
                                <div class="unified-dropdown-trigger" id="leadSourceTrigger">
                                    <div class="unified-dropdown-value">
                                        <span class="unified-status-dot" style="background: #007AFF;"></span>
                                        <span>Website</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="leadSourceMenu">
                                    <div class="unified-dropdown-option selected" data-value="Website" data-color="#007AFF">
                                        <span class="unified-status-dot" style="background: #007AFF;"></span>
                                        <span>Website</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Referral" data-color="#34C759">
                                        <span class="unified-status-dot" style="background: #34C759;"></span>
                                        <span>Referral</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Ad Campaign" data-color="#FF9500">
                                        <span class="unified-status-dot" style="background: #FF9500;"></span>
                                        <span>Ad Campaign</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Social Media" data-color="#5856D6">
                                        <span class="unified-status-dot" style="background: #5856D6;"></span>
                                        <span>Social Media</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                    <div class="unified-dropdown-option" data-value="Other" data-color="#8E8E93">
                                        <span class="unified-status-dot" style="background: #8E8E93;"></span>
                                        <span>Other</span>
                                        <i class="fas fa-check check-icon"></i>
                                    </div>
                                </div>
                                <input type="hidden" id="leadSource" name="leadSource" value="Website">
                            </div>
                        </div>
                        
                        <!-- Value -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-dollar-sign"></i> Value <span class="optional">(optional)</span>
                            </label>
                            <div class="unified-input-group">
                                <span class="input-addon">$</span>
                                <input type="number" class="unified-input" id="leadValue" placeholder="0" min="0" step="1">
                            </div>
                        </div>
                        
                        <!-- Contact -->
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-address-book"></i> Contact
                            </label>
                            <input type="text" class="unified-input" id="leadContact" placeholder="Email or phone number">
                        </div>
                        
                        <!-- Notes - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                Notes <span class="optional">(optional)</span>
                            </label>
                            <textarea class="unified-textarea" id="leadNotes" rows="2" placeholder="Add notes about this lead..."></textarea>
                        </div>
                        
                        <!-- Spreadsheet Selection - Full Width -->
                        <div class="unified-form-field full-width">
                            <label class="unified-form-label">
                                <i class="fas fa-table"></i> Add to Spreadsheet
                            </label>
                            <div class="unified-dropdown" id="leadSpreadsheetDropdown">
                                <div class="unified-dropdown-trigger" id="leadSpreadsheetTrigger">
                                    <div class="unified-dropdown-value">
                                        <i class="fas fa-table" style="color: var(--accent);"></i>
                                        <span id="leadSpreadsheetLabel">Select spreadsheet</span>
                                    </div>
                                    <i class="fas fa-chevron-down unified-dropdown-arrow"></i>
                                </div>
                                <div class="unified-dropdown-menu" id="leadSpreadsheetMenu"></div>
                                <input type="hidden" id="leadSpreadsheet" name="leadSpreadsheet" value="">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" id="cancelLeadBtn">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary">
                        <i class="fas fa-check"></i> Create Lead
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Adding Teammates -->
    <div class="unified-modal" id="teammateModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-user-plus"></i> Add Team Member</h2>
                    <p class="subtitle">Invite someone to join your team</p>
                </div>
                <button class="unified-modal-close" id="closeTeammateModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="teammateForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid single-col">
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-user"></i> Full Name <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="teammateName" required placeholder="Enter teammate's name">
                        </div>
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-envelope"></i> Email Address <span class="required">*</span>
                            </label>
                            <input type="email" class="unified-input" id="teammateEmail" required placeholder="Enter teammate's email">
                            <p class="unified-form-hint">An invitation will be sent to this email</p>
                        </div>
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-briefcase"></i> Role/Occupation <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="teammateOccupation" required placeholder="e.g., Project Manager, Developer">
                        </div>
                    </div>
                </div>
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" id="cancelTeammateBtn">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary">
                        <i class="fas fa-paper-plane"></i> Send Invitation
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Join Team Modal -->
    <div class="unified-modal" id="joinTeamModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-sign-in-alt"></i> Join a Team</h2>
                    <p class="subtitle">Enter the team code to request access</p>
                </div>
                <button class="unified-modal-close" id="closeJoinTeamModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="joinTeamModalForm">
                <div class="unified-modal-body">
                    <div class="unified-form-grid single-col">
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-key"></i> Team Code <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="joinTeamCodeModalInput" required placeholder="e.g., TEAM-ABC123 or ABC123" maxlength="11" style="text-transform: uppercase;">
                            <p class="unified-form-hint">Ask your team admin for the team code</p>
                        </div>
                    </div>
                </div>
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" id="cancelJoinTeamBtn">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary">
                        <i class="fas fa-arrow-right"></i>
                        Join Team
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Custom Column Modal -->
    <div class="modal" id="customColumnModal">
        <div class="modal-content custom-column-modal">
            <div class="modal-header">
                <h2><i class="fas fa-columns"></i> Create Column</h2>
                <button class="modal-close" id="closeCustomColumnModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="custom-column-form">
                <!-- Column Name -->
                <div class="form-group">
                    <label>Column Name</label>
                    <input type="text" id="customColumnName" placeholder="e.g. Status, Difficulty, Client" maxlength="30">
                    <span class="field-error" id="columnNameError"></span>
                </div>

                <!-- Input Type Selector -->
                <div class="form-group">
                    <label>Input Type</label>
                    <div class="input-type-selector" id="inputTypeSelector">
                        <button type="button" class="type-option active" data-type="dropdown">
                            <i class="fas fa-caret-square-down"></i>
                            <span>Dropdown</span>
                        </button>
                        <button type="button" class="type-option" data-type="slider">
                            <i class="fas fa-sliders-h"></i>
                            <span>Slider</span>
                        </button>
                        <button type="button" class="type-option" data-type="number">
                            <i class="fas fa-hashtag"></i>
                            <span>Number</span>
                        </button>
                        <button type="button" class="type-option" data-type="text">
                            <i class="fas fa-font"></i>
                            <span>Text</span>
                        </button>
                        <button type="button" class="type-option" data-type="link">
                            <i class="fas fa-link"></i>
                            <span>Link</span>
                        </button>
                    </div>
                </div>

                <!-- Dropdown Options (only visible when type = dropdown) -->
                <div class="form-group dropdown-options-group" id="dropdownOptionsGroup">
                    <label>Dropdown Options</label>
                    <div class="dropdown-options-list" id="dropdownOptionsList">
                        <div class="dropdown-option-item">
                            <input type="text" class="dropdown-option-input" placeholder="Option 1" maxlength="25">
                            <div class="option-color-picker">
                                <button type="button" class="color-swatch active" data-color="#9CA3AF" style="background: #9CA3AF" title="Grey"></button>
                                <button type="button" class="color-swatch" data-color="#3B82F6" style="background: #3B82F6" title="Blue"></button>
                                <button type="button" class="color-swatch" data-color="#22C55E" style="background: #22C55E" title="Green"></button>
                                <button type="button" class="color-swatch" data-color="#EAB308" style="background: #EAB308" title="Yellow"></button>
                                <button type="button" class="color-swatch" data-color="#F97316" style="background: #F97316" title="Orange"></button>
                                <button type="button" class="color-swatch" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                                <button type="button" class="color-swatch" data-color="#A855F7" style="background: #A855F7" title="Purple"></button>
                            </div>
                            <button type="button" class="remove-option-btn" title="Remove">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="dropdown-option-item">
                            <input type="text" class="dropdown-option-input" placeholder="Option 2" maxlength="25">
                            <div class="option-color-picker">
                                <button type="button" class="color-swatch active" data-color="#9CA3AF" style="background: #9CA3AF" title="Grey"></button>
                                <button type="button" class="color-swatch" data-color="#3B82F6" style="background: #3B82F6" title="Blue"></button>
                                <button type="button" class="color-swatch" data-color="#22C55E" style="background: #22C55E" title="Green"></button>
                                <button type="button" class="color-swatch" data-color="#EAB308" style="background: #EAB308" title="Yellow"></button>
                                <button type="button" class="color-swatch" data-color="#F97316" style="background: #F97316" title="Orange"></button>
                                <button type="button" class="color-swatch" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                                <button type="button" class="color-swatch" data-color="#A855F7" style="background: #A855F7" title="Purple"></button>
                            </div>
                            <button type="button" class="remove-option-btn" title="Remove">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" class="add-option-btn" id="addDropdownOption">
                        <i class="fas fa-plus"></i> Add option
                    </button>
                </div>

                <!-- Slider Config (only visible when type = slider) -->
                <div class="form-group slider-config-group" id="sliderConfigGroup" style="display: none;">
                    <label>Slider Range</label>
                    <div class="slider-range-inputs">
                        <div class="range-input">
                            <span>Min</span>
                            <input type="number" id="sliderMin" value="0" min="0" max="999">
                        </div>
                        <div class="range-input">
                            <span>Max</span>
                            <input type="number" id="sliderMax" value="100" min="1" max="1000">
                        </div>
                    </div>
                    
                    <!-- Slider Color Ranges -->
                    <label style="margin-top: 16px;">Color Ranges</label>
                    <div class="slider-color-ranges" id="sliderColorRanges">
                        <div class="color-range-item">
                            <input type="number" class="range-min-input" value="0" min="0" placeholder="Min">
                            <span class="range-separator">–</span>
                            <input type="number" class="range-max-input" value="33" placeholder="Max">
                            <div class="range-color-picker">
                                <button type="button" class="color-swatch active" data-color="#9CA3AF" style="background: #9CA3AF" title="Grey"></button>
                                <button type="button" class="color-swatch" data-color="#3B82F6" style="background: #3B82F6" title="Blue"></button>
                                <button type="button" class="color-swatch" data-color="#22C55E" style="background: #22C55E" title="Green"></button>
                                <button type="button" class="color-swatch" data-color="#EAB308" style="background: #EAB308" title="Yellow"></button>
                                <button type="button" class="color-swatch" data-color="#F97316" style="background: #F97316" title="Orange"></button>
                                <button type="button" class="color-swatch" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                                <button type="button" class="color-swatch" data-color="#A855F7" style="background: #A855F7" title="Purple"></button>
                            </div>
                            <button type="button" class="remove-range-btn" title="Remove range">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="color-range-item">
                            <input type="number" class="range-min-input" value="34" min="0" placeholder="Min">
                            <span class="range-separator">–</span>
                            <input type="number" class="range-max-input" value="66" placeholder="Max">
                            <div class="range-color-picker">
                                <button type="button" class="color-swatch" data-color="#9CA3AF" style="background: #9CA3AF" title="Grey"></button>
                                <button type="button" class="color-swatch" data-color="#3B82F6" style="background: #3B82F6" title="Blue"></button>
                                <button type="button" class="color-swatch" data-color="#22C55E" style="background: #22C55E" title="Green"></button>
                                <button type="button" class="color-swatch active" data-color="#EAB308" style="background: #EAB308" title="Yellow"></button>
                                <button type="button" class="color-swatch" data-color="#F97316" style="background: #F97316" title="Orange"></button>
                                <button type="button" class="color-swatch" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                                <button type="button" class="color-swatch" data-color="#A855F7" style="background: #A855F7" title="Purple"></button>
                            </div>
                            <button type="button" class="remove-range-btn" title="Remove range">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="color-range-item">
                            <input type="number" class="range-min-input" value="67" min="0" placeholder="Min">
                            <span class="range-separator">–</span>
                            <input type="number" class="range-max-input" value="100" placeholder="Max">
                            <div class="range-color-picker">
                                <button type="button" class="color-swatch" data-color="#9CA3AF" style="background: #9CA3AF" title="Grey"></button>
                                <button type="button" class="color-swatch" data-color="#3B82F6" style="background: #3B82F6" title="Blue"></button>
                                <button type="button" class="color-swatch active" data-color="#22C55E" style="background: #22C55E" title="Green"></button>
                                <button type="button" class="color-swatch" data-color="#EAB308" style="background: #EAB308" title="Yellow"></button>
                                <button type="button" class="color-swatch" data-color="#F97316" style="background: #F97316" title="Orange"></button>
                                <button type="button" class="color-swatch" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                                <button type="button" class="color-swatch" data-color="#A855F7" style="background: #A855F7" title="Purple"></button>
                            </div>
                            <button type="button" class="remove-range-btn" title="Remove range">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" class="add-range-btn" id="addColorRange">
                        <i class="fas fa-plus"></i> Add range
                    </button>
                </div>

                <!-- Icon Selector -->
                <div class="form-group">
                    <label>Column Icon</label>
                    <div class="icon-picker" id="iconPicker">
                        <button type="button" class="icon-option active" data-icon="fa-tag" title="Tag">
                            <i class="fas fa-tag"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-flag" title="Flag">
                            <i class="fas fa-flag"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-star" title="Star">
                            <i class="fas fa-star"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-check-circle" title="Check">
                            <i class="fas fa-check-circle"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-clock" title="Clock">
                            <i class="fas fa-clock"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-bolt" title="Bolt">
                            <i class="fas fa-bolt"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-fire" title="Fire">
                            <i class="fas fa-fire"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-heart" title="Heart">
                            <i class="fas fa-heart"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-thumbs-up" title="Thumbs Up">
                            <i class="fas fa-thumbs-up"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-gem" title="Gem">
                            <i class="fas fa-gem"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-users" title="Users">
                            <i class="fas fa-users"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-briefcase" title="Briefcase">
                            <i class="fas fa-briefcase"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-chart-bar" title="Chart">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-link" title="Link">
                            <i class="fas fa-link"></i>
                        </button>
                        <button type="button" class="icon-option" data-icon="fa-bookmark" title="Bookmark">
                            <i class="fas fa-bookmark"></i>
                        </button>
                    </div>
                </div>

                <!-- Actions -->
                <div class="custom-column-actions">
                    <button type="button" class="btn-secondary" id="cancelCustomColumn">Cancel</button>
                    <button type="button" class="btn-primary" id="createCustomColumn">
                        <i class="fas fa-plus"></i> Create
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Link Lobby: Add/Edit Group Modal - Unified Style -->
    <div class="unified-modal" id="linkGroupModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2 id="linkGroupModalTitle"><i class="fas fa-folder-plus"></i> Create Group</h2>
                    <p class="subtitle">Organize your links into groups</p>
                </div>
                <button class="unified-modal-close" onclick="closeLinkGroupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="linkGroupForm" onsubmit="saveLinkGroup(event)">
                <div class="unified-modal-body">
                    <input type="hidden" id="linkGroupId" value="">
                    <div class="unified-form-grid single-col">
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                Group Name <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="linkGroupName" placeholder="e.g. Design Resources, Documentation" required maxlength="50">
                        </div>
                        <div class="unified-form-field">
                            <label class="unified-checkbox-label">
                                <input type="checkbox" id="linkGroupAutoDomain">
                                <div class="unified-checkbox-content">
                                    <span class="unified-checkbox-title">Auto-group links by domain</span>
                                    <span class="unified-checkbox-desc">Links will be automatically organized into subgroups by website domain</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" onclick="closeLinkGroupModal()">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary" id="linkGroupSubmitBtn">
                        <i class="fas fa-plus"></i> Create Group
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Link Lobby: Add/Edit Link Modal - Unified Style -->
    <div class="unified-modal" id="linkModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2 id="linkModalTitle"><i class="fas fa-link"></i> Add Link</h2>
                    <p class="subtitle">Save a link to your group</p>
                </div>
                <button class="unified-modal-close" onclick="closeLinkModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="linkForm" onsubmit="saveLink(event)">
                <div class="unified-modal-body">
                    <input type="hidden" id="linkId" value="">
                    <input type="hidden" id="linkGroupIdForLink" value="">
                    <input type="hidden" id="linkDomainGroupId" value="">
                    <div class="unified-form-grid single-col">
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-globe"></i> URL <span class="required">*</span>
                            </label>
                            <input type="url" class="unified-input" id="linkUrl" placeholder="https://example.com" required>
                        </div>
                        <div class="unified-form-field">
                            <label class="unified-form-label">
                                <i class="fas fa-tag"></i> Label <span class="required">*</span>
                            </label>
                            <input type="text" class="unified-input" id="linkLabel" placeholder="e.g. Design System Docs" required maxlength="100">
                        </div>
                        <div class="link-preview" id="linkPreview" style="display: none; padding: 12px; background: var(--bg-surface); border-radius: 10px; display: flex; align-items: center; gap: 10px;">
                            <img id="linkFaviconPreview" src="" alt="" class="link-favicon-preview" style="width: 20px; height: 20px; border-radius: 4px;">
                            <span id="linkDomainPreview" style="font-size: 13px; color: var(--text-muted);"></span>
                        </div>
                    </div>
                </div>
                <div class="unified-modal-footer">
                    <button type="button" class="unified-btn unified-btn-secondary" onclick="closeLinkModal()">Cancel</button>
                    <button type="submit" class="unified-btn unified-btn-primary" id="linkSubmitBtn">
                        <i class="fas fa-plus"></i> Add Link
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Link Lobby: Delete Confirmation Modal - Unified Style -->
    <div class="unified-modal" id="deleteLinkGroupModal">
        <div class="unified-modal-container modal-sm">
            <div class="unified-modal-header">
                <div class="unified-modal-title">
                    <h2><i class="fas fa-exclamation-triangle"></i> Delete Group</h2>
                </div>
                <button class="unified-modal-close" onclick="closeDeleteLinkGroupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unified-modal-body">
                <div class="unified-confirm-box danger">
                    <div class="unified-confirm-icon">
                        <i class="fas fa-trash"></i>
                    </div>
                    <div class="unified-confirm-content">
                        <p class="unified-confirm-title">Delete "<strong id="deleteGroupName"></strong>"?</p>
                        <p class="unified-confirm-text">This will also delete all links within this group. This action cannot be undone.</p>
                    </div>
                </div>
                <input type="hidden" id="deleteGroupId" value="">
            </div>
            <div class="unified-modal-footer">
                <button type="button" class="unified-btn unified-btn-secondary" onclick="closeDeleteLinkGroupModal()">Cancel</button>
                <button type="button" class="unified-btn unified-btn-danger" onclick="confirmDeleteLinkGroup()">
                    <i class="fas fa-trash"></i> Delete Group
                </button>
            </div>
        </div>
    </div>

    <!-- Spreadsheet Context Menu (Right-click) -->
    <div class="spreadsheet-context-menu" id="spreadsheetContextMenu">
        <div class="context-menu-item" id="contextMenuOpen">
            <i class="fas fa-external-link-alt"></i>
            <span>Open</span>
        </div>
        <div class="context-menu-item" id="contextMenuRename">
            <i class="fas fa-pen"></i>
            <span>Rename</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item danger" id="contextMenuDelete">
            <i class="fas fa-trash"></i>
            <span>Delete</span>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer"></div>

    <!-- Main JavaScript -->
    <script src="main.js?v=17"></script>
</body>
</html>